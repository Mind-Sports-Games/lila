!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Chessground=e()}}((function(){return function e(t,n,i){function r(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var p=n[s]={exports:{}};t[s][0].call(p.exports,(function(e){return r(t[s][1][e]||e)}),p,p.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.render=n.anim=void 0;const i=e("./util");function r(e,t){const n=e(t);return t.dom.redraw(),n}function o(e,t){return{key:e,pos:i.key2pos(e),piece:t}}function s(e,t){return t.sort(((t,n)=>i.distanceSq(e.pos,t.pos)-i.distanceSq(e.pos,n.pos)))[0]}function a(e,t){const n=e.animation.current;if(void 0===n)return void(e.dom.destroyed||e.dom.redrawNow());const i=1-(t-n.start)*n.frequency;if(i<=0)e.animation.current=void 0,e.dom.redrawNow();else{const t=(r=i)<.5?4*r*r*r:(r-1)*(2*r-2)*(2*r-2)+1;for(const e of n.plan.anims.values())e[2]=e[0]*t,e[3]=e[1]*t;e.dom.redrawNow(!0),requestAnimationFrame(((t=performance.now())=>a(e,t)))}var r}n.anim=function(e,t){return t.animation.enabled?function(e,t){const n=new Map(t.pieces),r=e(t),c=function(e,t){const n=new Map,r=[],a=new Map,c=[],l=[],p=new Map;let d,u,f;for(const[i,s]of e)p.set(i,o(i,s));for(const s of i.allKeys(t.dimensions))d=t.pieces.get(s),u=p.get(s),d?u?i.samePiece(d,u.piece)||(c.push(u),l.push(o(s,d))):l.push(o(s,d)):u&&c.push(u);for(const o of l)u=s(o,c.filter((e=>i.samePiece(o.piece,e.piece)))),u&&(f=[u.pos[0]-o.pos[0],u.pos[1]-o.pos[1]],n.set(o.key,f.concat(f)),r.push(u.key));for(const i of c)r.includes(i.key)||a.set(i.key,i.piece);return{anims:n,fadings:a}}(n,t);if(c.anims.size||c.fadings.size){const e=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:c},e||a(t,performance.now())}else t.dom.redraw();return r}(e,t):r(e,t)},n.render=r},{"./util":20}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.start=void 0;const i=e("./board"),r=e("./fen"),o=e("./config"),s=e("./anim"),a=e("./drag"),c=e("./explosion");n.start=function(e,t){return{set(n){var r;n.orientation&&n.orientation!==e.orientation&&(r=n.orientation,i.setOrientation(e,r),t()),(n.fen?s.anim:s.render)((e=>(0,o.configure)(e,n)),e)},state:e,getFen:()=>(0,r.write)(e.pieces,e.dimensions,e.variant),toggleOrientation:function(){i.toggleOrientation(e),t()},setPieces(t){(0,s.anim)((e=>i.setPieces(e,t)),e)},setPiecesNoAnim(t){i.setPieces(e,t),e.dom.redraw()},setPocketPieces(t){(0,s.render)((e=>e.pocketPieces=t),e)},selectSquare(t,n){t?(0,s.anim)((e=>i.selectSquare(e,t,n)),e):e.selected&&(i.unselect(e),e.dom.redraw())},resetSelectedPieces(){(0,s.render)((e=>e.selectedPieces=new Map),e)},move(t,n){(0,s.anim)((e=>i.baseMove(e,t,n)),e)},moveNoAnim(t,n){i.baseMove(e,t,n),e.dom.redraw()},lift(t){(0,s.anim)((e=>i.userLift(e,t)),e)},liftNoAnim(t){i.userLift(e,t),e.dom.redraw()},newPiece(t,n){(0,s.anim)((e=>i.baseNewPiece(e,t,n)),e)},playPremove(){if(e.premovable.current){if((0,s.anim)(i.playPremove,e))return!0;e.dom.redraw()}return!1},playPredrop(t){if(e.predroppable.current){const n=i.playPredrop(e,t);return e.dom.redraw(),n}return!1},cancelPremove(){(0,s.render)(i.unsetPremove,e)},cancelPredrop(){(0,s.render)(i.unsetPredrop,e)},cancelMove(){(0,s.render)((e=>{i.cancelMove(e),(0,a.cancel)(e)}),e)},stop(){(0,s.render)((e=>{i.stop(e),(0,a.cancel)(e)}),e)},explode(t){(0,c.default)(e,t)},setAutoShapes(t){(0,s.render)((e=>e.drawable.autoShapes=t),e)},setShapes(t){(0,s.render)((e=>e.drawable.shapes=t),e)},getKeyAtDomPos:t=>i.getKeyAtDomPos(t,e.orientation,e.dom.bounds(),e.dimensions,e.variant),redrawAll:t,dragNewPiece(t,n,i){(0,a.dragNewPiece)(e,t,n,i)},destroy(){i.stop(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}},{"./anim":1,"./board":3,"./config":5,"./drag":6,"./explosion":10,"./fen":11}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getSnappedKeyAtDomPos=n.p1Pov=n.undoButtonPressed=n.reorderDice=n.isPocketAtDomPos=n.isButtonAtDomPos=n.areMyDiceAtDomPos=n.getKeyAtDomPos=n.stop=n.cancelMove=n.playPredrop=n.playPremove=n.isDraggable=n.isPredroppable=n.canMove=n.unselect=n.setSelected=n.selectSquare=n.setGoScore=n.dropNewPiece=n.userLift=n.userMove=n.baseNewPiece=n.baseMove=n.unsetPredrop=n.unsetPremove=n.setPieces=n.reset=n.toggleOrientation=n.setOrientation=void 0;const i=e("./util"),r=e("./premove"),o=e("./predrop"),s=e("./transformations");function a(e,t){e.orientation=t,e.animation.current=e.draggable.current=e.selected=void 0}function c(e){e.premovable.current&&(e.premovable.current=void 0,(0,i.callUserFunction)(e.premovable.events.unset))}function l(e){const t=e.predroppable;t.current&&(t.current=void 0,(0,i.callUserFunction)(t.events.unset))}function p(e){var t;e.dropmode.active=!1,(0,i.callUserFunction)(null===(t=e.dropmode.events)||void 0===t?void 0:t.cancel)}function d(e,t,n){const r=e.pieces.get(t),o=e.pieces.get(n);if(t===n&&"togyzkumalak"!==e.variant||!r)return!1;const s=o&&o.playerIndex!==r.playerIndex?o:void 0;return n===e.selected&&g(e),(0,i.callUserFunction)(e.events.move,t,n,s),function(e,t,n){if(!e.autoCastle)return!1;const r=e.pieces.get(t);if(!r||"k-piece"!==r.role)return!1;const o=(0,i.key2pos)(t),s=(0,i.key2pos)(n);if(1!==o[1]&&8!==o[1]||o[1]!==s[1])return!1;5!==o[0]||e.pieces.has(n)||(7===s[0]?n=(0,i.pos2key)([8,s[1]]):3===s[0]&&(n=(0,i.pos2key)([1,s[1]])));const a=e.pieces.get(n);return!(!a||a.playerIndex!==r.playerIndex||"r-piece"!==a.role||(e.pieces.delete(t),e.pieces.delete(n),o[0]<s[0]?(e.pieces.set((0,i.pos2key)([7,s[1]]),r),e.pieces.set((0,i.pos2key)([6,s[1]]),a)):(e.pieces.set((0,i.pos2key)([3,s[1]]),r),e.pieces.set((0,i.pos2key)([4,s[1]]),a)),0))}(e,t,n)||(e.pieces.set(n,r),e.pieces.delete(t)),e.lastMove=[t,n],e.check=void 0,(0,i.callUserFunction)(e.events.change),s||!0}function u(e,t,n,r){if(e.pieces.has(n)){if(!r)return!1;e.pieces.delete(n)}return(0,i.callUserFunction)(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n],e.check=void 0,(0,i.callUserFunction)(e.events.change),e.movable.dests=void 0,e.dropmode.dropDests=void 0,e.turnPlayerIndex=(0,i.opposite)(e.turnPlayerIndex),!0}function f(e,t,n){const r=d(e,t,n);return r&&(e.movable.dests=void 0,e.dropmode.dropDests=void 0,e.liftable.liftDests=void 0,e.turnPlayerIndex=(0,i.opposite)(e.turnPlayerIndex),e.animation.current=void 0),r}function h(e,t,n){if(v(e,t,n)){const r=f(e,t,n);if(r){const o=e.hold.stop();g(e);const s={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:o};return!0!==r&&(s.captured=r),(0,i.callUserFunction)(e.movable.events.after,t,n,s),!0}}else if(function(e,t,n){return t!==n&&k(e,t)&&(0,i.containsX)((0,r.premove)(e.pieces,t,e.premovable.castle,e.dimensions,e.variant,e.chess960),n)}(e,t,n))return function(e,t,n,r){l(e),e.premovable.current=[t,n],(0,i.callUserFunction)(e.premovable.events.set,t,n,r)}(e,t,n,{ctrlKey:e.stats.ctrlKey}),g(e),!0;return g(e),!1}function m(e,t){e.selected=t,k(e,t)?e.premovable.dests=(0,r.premove)(e.pieces,t,e.premovable.castle,e.dimensions,e.variant,e.chess960):(e.premovable.dests=void 0,e.predroppable.dropDests=void 0)}function g(e){e.selected=void 0,e.premovable.dests=void 0,e.predroppable.dropDests=void 0,e.hold.cancel()}function b(e,t){const n=e.pieces.get(t);return!!n&&(!e.onlyDropsVariant||e.onlyDropsVariant&&"a0"===t)&&("both"===e.movable.playerIndex||e.movable.playerIndex===n.playerIndex&&e.turnPlayerIndex===n.playerIndex)}function v(e,t,n){var i,r;return(t!==n||"togyzkumalak"===e.variant)&&b(e,t)&&(e.movable.free||!!(null===(r=null===(i=e.movable.dests)||void 0===i?void 0:i.get(t))||void 0===r?void 0:r.includes(n)))}function k(e,t){const n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.playerIndex===n.playerIndex&&e.turnPlayerIndex!==n.playerIndex}function y(e){c(e),l(e),g(e)}n.setOrientation=a,n.toggleOrientation=function(e){"backgammon"===e.variant||"nackgammon"===e.variant?a(e,(0,i.oppositeOrientationBG)(e.orientation)):a(e,(0,i.oppositeOrientation)(e.orientation))},n.reset=function(e){e.lastMove=void 0,g(e),c(e),l(e)},n.setPieces=function(e,t){for(const[n,i]of t)i?e.pieces.set(n,i):e.pieces.delete(n)},n.unsetPremove=c,n.unsetPredrop=l,n.baseMove=d,n.baseNewPiece=u,n.userMove=h,n.userLift=function(e,t){const n=e.pieces.get(t);if(n&&e.liftable.liftDests&&e.liftable.liftDests.length>0&&e.liftable.liftDests.includes(t)&&e.turnPlayerIndex===n.playerIndex){if("backgammon"===e.variant||"nackgammon"===e.variant){const i=n.role.split("-")[0].substring(1),r=n.role.charAt(0);"1"===i?e.pieces.delete(t):e.pieces.set(t,{role:`${r}${+i-1}-piece`,playerIndex:n.playerIndex})}else e.pieces.delete(t);return e.movable.dests=void 0,e.dropmode.dropDests=void 0,e.liftable.liftDests=void 0,e.animation.current=void 0,(0,i.callUserFunction)(e.liftable.events.after,t),!0}return c(e),l(e),p(e),g(e),!1},n.dropNewPiece=function(e,t,n,r){const s=e.pieces.get(t);s&&(function(e,t,n){const i=e.pieces.get(t);return!(!i||t!==n&&e.pieces.has(n)||"both"!==e.movable.playerIndex&&(e.movable.playerIndex!==i.playerIndex||e.turnPlayerIndex!==i.playerIndex))}(e,t,n)||r)?(e.pieces.delete(t),u(e,s,n,r),(0,i.callUserFunction)(e.movable.events.afterNewPiece,s.role,n,{premove:!1,predrop:!1})):s&&function(e,t,n){const r=e.pieces.get(t),s=e.pieces.get(n);if(!r)return!1;const a=(0,i.containsX)((0,o.default)(e.pieces,r,e.dimensions,e.variant),n);return(!s||s.playerIndex!==e.movable.playerIndex)&&e.predroppable.enabled&&a&&e.movable.playerIndex===r.playerIndex&&e.turnPlayerIndex!==r.playerIndex}(e,t,n)?function(e,t,n){c(e),e.predroppable.current={role:t,key:n},(0,i.callUserFunction)(e.predroppable.events.set,t,n)}(e,s.role,n):(c(e),l(e),p(e)),e.pieces.delete(t),g(e)},n.setGoScore=function(e){e.selectOnly?e.simpleGoScores=(0,i.calculateGoScores)(e.selectedPieces,e.pieces,e.dimensions):e.simpleGoScores=void 0},n.selectSquare=function(e,t,n){if((0,i.callUserFunction)(e.events.select,t),e.selectOnly){const n=e.pieces.get(t);if(n){const r=(0,i.calculatePieceGroup)(t,e.pieces,e.dimensions);if(e.selectedPieces.has(t))for(const t of r)e.selectedPieces.delete(t);else for(const t of r)e.selectedPieces.set(t,n);e.simpleGoScores=(0,i.calculateGoScores)(e.selectedPieces,e.pieces,e.dimensions)}}else{if(e.selectedPieces.clear(),e.simpleGoScores=void 0,e.selected){if(e.selected===t&&!e.draggable.enabled)return g(e),void e.hold.cancel();if((e.selectable.enabled||n)&&e.selected!==t&&h(e,e.selected,t))return void(e.stats.dragged=!1)}(b(e,t)||k(e,t))&&(m(e,t),e.hold.start())}},n.setSelected=m,n.unselect=g,n.canMove=v,n.isPredroppable=function(e){var t,n;const i=e.dropmode.active?e.dropmode.piece:null===(t=e.draggable.current)||void 0===t?void 0:t.piece;return!!i&&(e.dropmode.active||"a0"===(null===(n=e.draggable.current)||void 0===n?void 0:n.orig))&&e.predroppable.enabled&&e.movable.playerIndex===i.playerIndex&&e.turnPlayerIndex!==i.playerIndex},n.isDraggable=function(e,t){const n=e.pieces.get(t);return!!n&&e.draggable.enabled&&("both"===e.movable.playerIndex||e.movable.playerIndex===n.playerIndex&&(e.turnPlayerIndex===n.playerIndex||e.premovable.enabled))},n.playPremove=function(e){const t=e.premovable.current;if(!t)return!1;const n=t[0],r=t[1];let o=!1;if(v(e,n,r)){const t=f(e,n,r);if(t){const s={premove:!0};!0!==t&&(s.captured=t),(0,i.callUserFunction)(e.movable.events.after,n,r,s),o=!0}}return c(e),o},n.playPredrop=function(e,t){const n=e.predroppable.current;let r=!1;if(!n)return!1;if(t(n)){u(e,{role:n.role,playerIndex:e.movable.playerIndex},n.key)&&((0,i.callUserFunction)(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),r=!0)}return l(e),r},n.cancelMove=y,n.stop=function(e){e.movable.playerIndex=e.movable.dests=e.dropmode.dropDests=e.liftable.liftDests=e.animation.current=void 0,e.gameButtonsActive=!1,y(e)},n.getKeyAtDomPos=function(e,t,n,r,o="chess"){const a=1/15,c="backgammon"===o||"nackgammon"===o?(e[0]-n.left)/n.width<1/15||(e[0]-n.left)/n.width>=14/15||(e[0]-n.left)/n.width>=7/15&&(e[0]-n.left)/n.width<=8/15?void 0:(e[0]-n.left)/n.width<=7/15?Math.ceil(r.width*((e[0]-n.left-n.width*a)/(12*n.width*a))):Math.ceil(r.width*((e[0]-n.left-2*n.width*a)/(12*n.width*a))):Math.ceil(r.width*((e[0]-n.left)/n.width)),l=("backgammon"===o||"nackgammon"===o)&&((e[1]-n.top)/n.height<=1/15||(e[1]-n.top)/n.height>=14/15||(e[1]-n.top)/n.height>=.4&&(e[1]-n.top)/n.height<=.6)?void 0:Math.ceil(r.height-r.height*((e[1]-n.top)/n.height));if(void 0!==l&&void 0!==c)return e=[c,l],(e=s.mapToP1[t](e,r))[0]>0&&e[0]<r.width+1&&e[1]>0&&e[1]<r.height+1?(0,i.pos2key)(e):void 0},n.areMyDiceAtDomPos=function(e,t,n,i,r,o="chess"){if(n!==i)return!1;const s="p1"===t&&"p2"===n||"p1vflip"===t&&"p1"===n?(e[0]-r.left)/r.width>1/15&&(e[0]-r.left)/r.width<7/15:(e[0]-r.left)/r.width>8/15&&(e[0]-r.left)/r.width<14/15,a=(e[1]-r.top)/r.height>6.5/15&&(e[1]-r.top)/r.height<8.5/15;return("backgammon"===o||"nackgammon"===o)&&s&&a},n.isButtonAtDomPos=function(e,t,n,i,r,o="chess"){if(n!==i)return!1;const s="p1"===t&&"p2"===n||"p1vflip"===t&&"p1"===n?(e[0]-r.left)/r.width>8/15&&(e[0]-r.left)/r.width<14/15:(e[0]-r.left)/r.width>1/15&&(e[0]-r.left)/r.width<7/15,a=(e[1]-r.top)/r.height>6.5/15&&(e[1]-r.top)/r.height<8.5/15;return("backgammon"===o||"nackgammon"===o)&&s&&a},n.isPocketAtDomPos=function(e,t,n,i,r="chess"){const o=(e[0]-i.left)/i.width<8/15&&(e[0]-i.left)/i.width>7/15,s="p1"===t&&"p1"===n||"p1vflip"===t&&"p2"===n?(e[1]-i.top)/i.height>2/15&&(e[1]-i.top)/i.height<7.4/15:(e[1]-i.top)/i.height>7.6/15&&(e[1]-i.top)/i.height<13/15;return("backgammon"===r||"nackgammon"===r)&&o&&s},n.reorderDice=function(e){e.gameButtonsActive&&(2===e.dice.length&&e.dice[0].isAvailable&&e.dice[1].isAvailable&&(e.dice=[e.dice[1],e.dice[0]]),(0,i.callUserFunction)(e.events.selectDice,e.dice))},n.undoButtonPressed=function(e){e.gameButtonsActive&&(0,i.callUserFunction)(e.events.undoButton)},n.p1Pov=function(e){return"p1"===e.myPlayerIndex},n.getSnappedKeyAtDomPos=function(e,t,n,o,s){const a=(0,i.key2pos)(e),c=(0,i.allPos)(s).filter((e=>(0,r.queen)(a[0],a[1],e[0],e[1])||(0,r.knight)(a[0],a[1],e[0],e[1]))),l=c.map((e=>(0,i.computeSquareCenter)((0,i.pos2key)(e),n,o,s))).map((e=>(0,i.distanceSq)(t,e))),[,p]=l.reduce(((e,t,n)=>e[0]<t?e:[t,n]),[l[0],0]);return(0,i.pos2key)(c[p])}},{"./predrop":13,"./premove":14,"./transformations":18,"./util":20}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Chessground=void 0;const i=e("./api"),r=e("./config"),o=e("./state"),s=e("./wrap"),a=e("./events"),c=e("./render"),l=e("./svg"),p=e("./util");function d(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame((()=>{e(),t=!1})))}}n.Chessground=function(e,t){const n=(0,o.defaults)();function u(){const t="dom"in n?n.dom.unbind:void 0,i=n.viewOnly&&!n.drawable.visible,r=(0,s.renderWrap)(e,n,i),o=p.memo((()=>r.board.getBoundingClientRect())),u=e=>{(0,c.render)(h),!e&&r.svg&&l.renderSvg(h,r.svg,r.customSvg)},f=()=>{o.clear(),(0,c.updateBounds)(h),r.svg&&l.renderSvg(h,r.svg,r.customSvg)},h=n;return h.dom={elements:r,bounds:o,redraw:d(u),redrawNow:u,unbind:t,relative:i},h.drawable.prevSvgHash="",u(!1),a.bindBoard(h,f),t||(h.dom.unbind=a.bindDocument(h,f)),h.events.insert&&h.events.insert(r),h}return(0,r.configure)(n,t||{}),(0,i.start)(u(),u)}},{"./api":2,"./config":5,"./events":9,"./render":15,"./state":16,"./svg":17,"./util":20,"./wrap":21}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.configure=void 0;const i=e("./board"),r=e("./fen");function o(e,t){for(const n in t)s(e[n])&&s(t[n])?o(e[n],t[n]):e[n]=t[n]}function s(e){return"object"==typeof e}n.configure=function(e,t){var n,s;if(t.movable&&t.movable.dests&&(e.movable.dests=void 0),(null===(n=t.dropmode)||void 0===n?void 0:n.dropDests)&&(e.dropmode.dropDests=void 0),(null===(s=t.drawable)||void 0===s?void 0:s.autoShapes)&&(e.drawable.autoShapes=[]),t.dice&&(e.dice=[]),o(e,t),t.dimensions&&(e.dimensions=t.dimensions),t.fen){const n=(0,r.read)(t.fen,e.dimensions,e.variant),i=(0,r.readPocket)(t.fen,e.variant);void 0!==e.pieces.get("a0")&&n.set("a0",e.pieces.get("a0")),e.pieces=n,e.pocketPieces=i,e.drawable.shapes=[]}if("check"in t&&function(e,t){e.check=void 0,!0===t&&(t=e.turnPlayerIndex);if(t)for(const[n,i]of e.pieces)"k-piece"===i.role&&i.playerIndex===t&&(e.check=n)}(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&(0,i.setSelected)(e,e.selected),(0,i.setGoScore)(e),(!e.animation.duration||e.animation.duration<100)&&(e.animation.enabled=!1),!e.movable.rookCastle&&e.movable.dests){const t="p1"===e.movable.playerIndex?1:8,n="e"+t,i=e.movable.dests.get(n),r=e.pieces.get(n);if(!i||!r||"k-piece"!==r.role)return;e.movable.dests.set(n,i.filter((e=>!(e==="a"+t&&i.includes("c"+t)||e==="h"+t&&i.includes("g"+t)))))}}},{"./board":3,"./fen":11}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.cancel=n.end=n.move=n.dragNewPiece=n.start=void 0;const i=e("./board"),r=e("./util"),o=e("./draw"),s=e("./anim"),a=e("./predrop"),c=e("./transformations");function l(e){requestAnimationFrame((()=>{var t;const n=e.draggable.current;if(!n)return;(null===(t=e.animation.current)||void 0===t?void 0:t.plan.anims.has(n.orig))&&(e.animation.current=void 0);const i=e.pieces.get(n.orig);if(i&&r.samePiece(i,n.piece)){if(!n.started&&r.distanceSq(n.epos,n.rel)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if("function"==typeof n.element){const e=n.element();if(!e)return;e.cgDragging=!0,e.classList.add("dragging"),n.element=e}n.pos=[n.epos[0]-n.rel[0],n.epos[1]-n.rel[1]];const t=r.posToTranslateAbs(e.dom.bounds(),e.dimensions,e.variant)(n.origPos,e.orientation);t[0]+=n.pos[0]+n.dec[0],t[1]+=n.pos[1]+n.dec[1],r.translateAbs(n.element,t)}}else p(e);l(e)}))}function p(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,i.unselect(e),d(e),e.dom.redraw())}function d(e){const t=e.dom.elements;t.ghost&&r.setVisible(t.ghost,!1)}function u(e,t,n,i){const o=c.mapToP1Inverse[i](r.key2pos(e),n);return{left:t.left+t.width*(o[0]-1)/n.width,top:t.top+t.height*(n.height-o[1])/n.height,width:t.width/n.width,height:t.height/n.height}}function f(e,t){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===t&&"PIECE"===n.tagName)return n;n=n.nextSibling}}n.start=function(e,t){if(!t.isTrusted||void 0!==t.button&&0!==t.button)return;if(t.touches&&t.touches.length>1)return;const n=e.dom.bounds(),a=r.eventPosition(t),c=i.getKeyAtDomPos(a,e.orientation,n,e.dimensions,e.variant);if(!c)return;const p=e.pieces.get(c),d=e.selected;d||!e.drawable.enabled||!e.drawable.eraseOnClick&&p&&p.playerIndex===e.turnPlayerIndex||(0,o.clear)(e),!1===t.cancelable||t.touches&&e.movable.playerIndex&&!p&&!d&&!function(e,t){const n=e.orientation,i=e.dom.bounds(),o=Math.pow(i.width/8,2);for(const s in e.pieces){const a=u(s,i,e.dimensions,n),c=[a.left+a.width/2,a.top+a.height/2];if(r.distanceSq(c,t)<=o)return!0}return!1}(e,a)||t.preventDefault();const h=!!e.premovable.current,m=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&i.canMove(e,e.selected,c)&&!e.selectOnly?(0,s.anim)((e=>i.selectSquare(e,c)),e):i.selectSquare(e,c);const g=e.selected===c,b=f(e,c);if(p&&b&&g&&i.isDraggable(e,c)&&!e.selectOnly){const i=u(c,n,e.dimensions,e.orientation);e.draggable.current={orig:c,origPos:r.key2pos(c),piece:p,rel:a,epos:a,pos:[0,0],dec:e.draggable.centerPiece?[a[0]-(i.left+i.width/2),a[1]-(i.top+i.height/2)]:[0,0],started:e.draggable.autoDistance&&e.stats.dragged,element:b,previouslySelected:d,originTarget:t.target},b.cgDragging=!0,b.classList.add("dragging");const o=e.dom.elements.ghost;if(o){const t=p.promoted?"promoted ":"",i=p.playerIndex===e.myPlayerIndex?"ally":"enemy";o.className=`ghost ${p.playerIndex} ${t}${p.role} ${i}`,r.translateAbs(o,r.posToTranslateAbs(n,e.dimensions,e.variant)(r.key2pos(c),e.orientation)),r.setVisible(o,!0)}l(e)}else h&&i.unsetPremove(e),m&&i.unsetPredrop(e);e.dom.redraw()},n.dragNewPiece=function(e,t,n,o){const s="a0";e.pieces.set(s,t),e.dom.redraw();const c=r.eventPosition(n),p=i.p1Pov(e),d=e.dom.bounds(),h=u(s,d,e.dimensions,e.orientation),m=[(p?0:e.dimensions.width-1)*h.width+d.left,(p?e.dimensions.height:-1)*h.height+d.top];e.draggable.current={orig:s,origPos:r.key2pos("a0"),piece:t,rel:m,epos:c,pos:[c[0]-m[0],c[1]-m[1]],dec:[-h.width/2,-h.height/2],started:!0,element:()=>f(e,s),originTarget:n.target,newPiece:!0,force:!!o},t&&i.isPredroppable(e)&&(e.predroppable.dropDests=(0,a.default)(e.pieces,t,e.dimensions,e.variant)),l(e)},n.move=function(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.epos=r.eventPosition(t))},n.end=function(e,t){const n=e.draggable.current;if(!n)return;if("touchend"===t.type&&!1!==t.cancelable&&t.preventDefault(),"touchend"===t.type&&n&&n.originTarget!==t.target&&!n.newPiece)return void(e.draggable.current=void 0);i.unsetPremove(e),i.unsetPredrop(e);const o=r.eventPosition(t)||n.epos,s=i.getKeyAtDomPos(o,e.orientation,e.dom.bounds(),e.dimensions,e.variant);s&&n.started&&n.orig!==s?n.newPiece?i.dropNewPiece(e,n.orig,s,n.force):(e.stats.ctrlKey=t.ctrlKey,i.userMove(e,n.orig,s)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!s&&(e.pieces.delete(n.orig),r.callUserFunction(e.events.change)),(!n||n.orig!==n.previouslySelected||n.orig!==s&&s)&&e.selectable.enabled||i.unselect(e),d(e),e.draggable.current=void 0,e.dom.redraw()},n.cancel=p},{"./anim":1,"./board":3,"./draw":7,"./predrop":13,"./transformations":18,"./util":20}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.clear=n.cancel=n.end=n.move=n.processDraw=n.start=void 0;const i=e("./board"),r=e("./util"),o=["green","red","blue","yellow"];function s(e){requestAnimationFrame((()=>{const t=e.drawable.current;if(t){const n=(0,i.getKeyAtDomPos)(t.pos,e.orientation,e.dom.bounds(),e.dimensions,e.variant);n||(t.snapToValidMove=!1);const r=t.snapToValidMove?(0,i.getSnappedKeyAtDomPos)(t.orig,t.pos,e.orientation,e.dom.bounds(),e.dimensions):n;r!==t.mouseSq&&(t.mouseSq=r,t.dest=r!==t.orig?r:void 0,e.dom.redrawNow()),s(e)}}))}function a(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function c(e){var t;const n=(e.shiftKey||e.ctrlKey)&&(0,r.isRightButton)(e),i=e.altKey||e.metaKey||(null===(t=e.getModifierState)||void 0===t?void 0:t.call(e,"AltGraph"));return o[(n?1:0)+(i?2:0)]}function l(e){e.onChange&&e.onChange(e.shapes)}n.start=function(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?(0,i.unselect)(e):(0,i.cancelMove)(e);const n=(0,r.eventPosition)(t),o=(0,i.getKeyAtDomPos)(n,e.orientation,e.dom.bounds(),e.dimensions,e.variant);o&&(e.drawable.current={orig:o,pos:n,brush:c(t),snapToValidMove:e.drawable.defaultSnapToValidMove},s(e))},n.processDraw=s,n.move=function(e,t){e.drawable.current&&(e.drawable.current.pos=(0,r.eventPosition)(t))},n.end=function(e){const t=e.drawable.current;t&&(t.mouseSq&&function(e,t){const n=e=>e.orig===t.orig&&e.dest===t.dest,i=e.shapes.filter(n)[0];i&&(e.shapes=e.shapes.filter((e=>!n(e))));i&&i.brush===t.brush||e.shapes.push(t);l(e)}(e.drawable,t),a(e))},n.cancel=a,n.clear=function(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),l(e.drawable))}},{"./board":3,"./util":20}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.drop=n.cancelDropMode=n.setDropMode=void 0;const i=e("./board"),r=e("./util"),o=e("./drag"),s=e("./predrop");n.setDropMode=function(e,t){e.dropmode.active=!0,e.dropmode.piece=t,(0,o.cancel)(e),i.unselect(e),t&&i.isPredroppable(e)&&(e.predroppable.dropDests=(0,s.default)(e.pieces,t,e.dimensions,e.variant))},n.cancelDropMode=function(e){var t;e.dropmode.active=!1,r.callUserFunction(null===(t=e.dropmode.events)||void 0===t?void 0:t.cancel)},n.drop=function(e,t){if(!e.dropmode.active)return;i.unsetPremove(e),i.unsetPredrop(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const o=r.eventPosition(t);if(o&&i.isPocketAtDomPos(o,e.orientation,e.turnPlayerIndex,e.dom.bounds(),e.variant))!function(e,t){var n;const o=e.dice.filter((e=>e.isAvailable)).length>0?e.dice.filter((e=>e.isAvailable))[0].value:void 0,s=o?r.pos2key([e.dimensions.width+1-o,"p1"===e.myPlayerIndex?2:1]):void 0,a=!!(e.dropmode.dropDests&&e.dropmode.dropDests.has(t)&&s)&&((null===(n=e.dropmode.dropDests.get(t))||void 0===n?void 0:n.includes(s))?s:e.dropmode.dropDests.get(t)[0]);a&&i.dropNewPiece(e,"a0",a,"backgammon"===e.variant||"nackgammon"===e.variant)}(e,n.role);else{const t=o&&i.getKeyAtDomPos(o,e.orientation,e.dom.bounds(),e.dimensions,e.variant);t&&i.dropNewPiece(e,"a0",t,"backgammon"===e.variant||"nackgammon"===e.variant)}}t.stopPropagation(),t.preventDefault(),e.dom.redraw()}},{"./board":3,"./drag":6,"./predrop":13,"./util":20}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.bindDocument=n.bindBoard=void 0;const i=e("./drag"),r=e("./draw"),o=e("./drop"),s=e("./util"),a=e("./board");function c(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function l(e){e.stopPropagation(),e.preventDefault()}function p(e,t,n){return i=>{e.drawable.current?e.drawable.enabled&&n(e,i):e.viewOnly||t(e,i)}}function d(e,t){const n=(0,s.eventPosition)(t),i=n&&(0,a.getKeyAtDomPos)(n,e.orientation,e.dom.bounds(),e.dimensions,e.variant);if(i&&e.pieces.get(i))return e.pieces.get(i)}n.bindBoard=function(e,t){const n=e.dom.elements.board;if(!e.dom.relative&&e.resizable&&"ResizeObserver"in window){new window.ResizeObserver(t).observe(n)}if(e.viewOnly)return;const c=function(e){return t=>{var n;if(e.draggable.current)i.cancel(e);else if(e.drawable.current)r.cancel(e);else if(t.shiftKey||(0,s.isRightButton)(t))e.drawable.enabled&&r.start(e,t);else if(!e.viewOnly)if(e.selectOnly)i.start(e,t);else{if((0,a.areMyDiceAtDomPos)((0,s.eventPosition)(t),e.orientation,e.turnPlayerIndex,e.myPlayerIndex,e.dom.bounds(),e.variant))return(0,a.reorderDice)(e),void l(t);if((0,a.isButtonAtDomPos)((0,s.eventPosition)(t),e.orientation,e.turnPlayerIndex,e.myPlayerIndex,e.dom.bounds(),e.variant))return(0,a.undoButtonPressed)(e),void l(t);if(!e.dropmode.active||void 0!==d(e,t)&&"backgammon"!==e.variant&&"nackgammon"!==e.variant)if(e.dropmode.active&&e.movable.playerIndex!==e.turnPlayerIndex&&(null===(n=d(e,t))||void 0===n?void 0:n.playerIndex)===e.turnPlayerIndex&&!e.onlyDropsVariant)(0,o.drop)(e,t);else if(e.onlyDropsVariant||(0,o.cancelDropMode)(e),e.singleClickMoveVariant){const n=e.dom.bounds(),i=(0,s.eventPosition)(t),r=(0,a.getKeyAtDomPos)(i,e.orientation,n,e.dimensions,e.variant);if(!r)return;const o=e.pieces.get(r),c=e.liftable.liftDests&&e.liftable.liftDests.length>0&&e.liftable.liftDests.includes(r),p=e.movable.dests&&e.movable.dests.has(r),d=e.dice.filter((e=>e.isAvailable)).length>0?e.dice.filter((e=>e.isAvailable))[0].value:void 0;if(o&&o.playerIndex===e.turnPlayerIndex&&p){const n=e.movable.dests.get(r)[0];void 0!==d&&c&&d!==(0,s.backgammonPosDiff)(r,n)?((0,a.userLift)(e,r),l(t)):((0,a.userMove)(e,r,n),l(t)),e.dom.redraw()}else o&&o.playerIndex===e.turnPlayerIndex&&c&&((0,a.userLift)(e,r),l(t),e.dom.redraw())}else i.start(e,t);else(0,o.drop)(e,t)}}}(e);n.addEventListener("touchstart",c,{passive:!1}),n.addEventListener("mousedown",c,{passive:!1}),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",(e=>e.preventDefault()))},n.bindDocument=function(e,t){const n=[];if(e.dom.relative||!e.resizable||"ResizeObserver"in window||n.push(c(document.body,"chessground.resize",t)),!e.viewOnly){const t=p(e,i.move,r.move),o=p(e,i.end,r.end);for(const e of["touchmove","mousemove"])n.push(c(document,e,t));for(const e of["touchend","mouseup"])n.push(c(document,e,o));const s=()=>e.dom.bounds.clear();n.push(c(document,"scroll",s,{capture:!0,passive:!0})),n.push(c(window,"resize",s,{passive:!0}))}return()=>n.forEach((e=>e()))}},{"./board":3,"./drag":6,"./draw":7,"./drop":8,"./util":20}],10:[function(e,t,n){"use strict";function i(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout((()=>{i(e,2),setTimeout((()=>i(e,void 0)),120)}),120)}},{}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.write=n.readPocket=n.read=n.initial=void 0;const i=e("./util");n.initial="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR";const r=["oware","togyzkumalak","backgammon","nackgammon"],o=["oware","togyzkumalak"];function s(e){return e.replace("+","p")+"-piece"}function a(e){const t=e.slice(0,e.indexOf("-"));return t.length>1?t.replace("p","+"):t}n.read=function(e,t,a){"start"===e&&(e=n.initial),-1!==e.indexOf("[")&&(e=e.slice(0,e.indexOf("[")));const c=new Map;let l=t.height,p=0,d=!1,u=0;if(r.includes(a))for(const n of e.split(" ")[0].split("/")){for(const e of n.split(","))if(isNaN(+e)){p+=1+u,u=0;const t=e.slice(0,-1),n=e.substring(e.length-1).toLowerCase(),r={role:`${n}${t}-piece`,playerIndex:o.includes(a)?1===l?"p1":"p2":e.substring(e.length-1)===n?"p2":"p1"};c.set((0,i.pos2key)([p,l]),r)}else u+=+e;if(--l,0===l)return c;p=0,u=0}else{let n=!1;for(let r=0;r<e.length;r++){if(n){n=!1;continue}const o=e[r];switch(o){case" ":return c;case"/":if(--l,0===l)return c;p=0,u=0;break;case"+":d=!0;break;case"~":{const e=c.get((0,i.pos2key)([p,l]));e&&(e.promoted=!0);break}default:{const a=parseInt(o,10);if(a>0){let i=!1;if(t.width>9&&r<e.length+1&&parseInt(e[r+1])>=0){const t=parseInt(o+e[r+1]);t>0&&(p+=t,i=!0,n=!0)}i||(u+=a)}else{p+=1+u,u=0;const e=o.toLowerCase(),t=o===e?"p2":"p1",n={role:s(e),playerIndex:t};d&&(n.role="p"+n.role,n.promoted=!0,d=!1),c.set((0,i.pos2key)([p,l]),n)}}}}}return c},n.readPocket=function(e,t){if("backgammon"!==t&&"nackgammon"!==t||-1===e.indexOf("[")||-1===e.indexOf("]"))return[];{const t=e.indexOf("[",0),n=e.indexOf("]",t),i=e.substring(t+1,n);if(""===i)return[];const r=[];for(const e of i.split(",")){const t=e.slice(0,-1),n=e.substring(e.length-1).toLowerCase(),i={role:`${n}${t}-piece`,playerIndex:e.substring(e.length-1)===n?"p2":"p1"};r.push(i)}return r}},n.write=function(e,t,n){const s=i.invNRanks.slice(-t.height).map((s=>i.NRanks.slice(0,t.width).map((c=>{const l=e.get((0,i.pos2key)([c,s]));if(l){if(r.includes(n)){const e=l.role.charAt(0),i=o.includes(n)||"p1"===l.playerIndex?e.toUpperCase():e;return l.role.split("-")[0].substring(1)+i+(c===t.width?"":",")}{const e=a(l.role)+(l.promoted&&"+"!==a(l.role).charAt(0)?"~":"");return"p1"===l.playerIndex?e.toUpperCase():e}}return"1"+(r.includes(n)?",":"")})).join(""))).join("/");return r.includes(n)?s.replace(/(1,){2,}/g,(e=>(e.length/2).toString()+",")).replace(",/","/").replace(", "," "):s.replace(/1{2,}/g,(e=>e.length.toString()))}},{"./util":20}],12:[function(e,t,n){t.exports=e("./chessground").Chessground},{"./chessground":4}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=e("./util"),r=(e,t)=>!0;function o(e,t,n,i){const r=i.height;return e<1&&(e+=r),t<1&&(t+=r),(i,o)=>("p2"===n&&(o=r-o+1),e<=o&&o<=t)}function s(e){return(t,n)=>{const r=i.pos2key([t,n]);return!e.has(r)}}n.default=function(e,t,n,a){const c=t.playerIndex,l=t.role;let p=r;switch(a){case"crazyhouse":case"shouse":case"capahouse":case"gothhouse":switch(l){case"p-piece":p=o(2,-1,c,n)}break;case"placement":p=o(1,1,c,n);break;case"sittuyin":switch(l){case"r-piece":p=o(1,1,c,n);break;default:p=(e,t)=>{const i=n.width,r=n.height;return"p2"===c&&(e=i-e+1,t=r-t+1),t<3||3===t&&e>4}}break;case"shogi":case"minishogi":case"gorogoro":switch(l){case"p-piece":case"l-piece":p=o(1,-1,c,n);break;case"n-piece":p=o(1,-2,c,n)}break;case"kyotoshogi":case"dobutsu":case"amazons":p=r;break;case"torishogi":switch(l){case"s-piece":p=o(1,-1,c,n)}break;case"grandhouse":switch(l){case"p-piece":p=o(2,7,c,n)}break;case"shogun":p=o(1,5,c,n);break;case"synochess":p=(e,t)=>5===t;break;case"shinobi":p=(e,t)=>t<=4;break;case"flipello10":case"flipello":p=s(e);break;case"go9x9":case"go13x13":case"go19x19":p=s(e);break;default:console.warn("Unknown drop variant",a)}return i.allKeys(n).map(i.key2pos).filter((t=>{var n;return(null===(n=e.get(i.pos2key(t)))||void 0===n?void 0:n.playerIndex)!==c&&p(t[0],t[1])})).map(i.pos2key)}},{"./util":20}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.premove=n.loachecker=n.queen=n.knight=void 0;const i=e("./util");function r(e,t){return Math.abs(e-t)}function o(e){return(t,n,i,o)=>r(t,i)<2&&("p1"===e?o===n+1||n<=2&&o===n+2&&t===i:o===n-1||n>=7&&o===n-2&&t===i)}n.knight=(e,t,n,i)=>{const o=r(e,n),s=r(t,i);return 1===o&&2===s||2===o&&1===s};const s=(e,t,n,i)=>r(e,n)===r(t,i),a=(e,t,n,i)=>e===n||t===i;n.queen=(e,t,n,i)=>s(e,t,n,i)||a(e,t,n,i);function c(e,t,n){return(o,s,a,c)=>r(o,a)<2&&r(s,c)<2||n&&s===c&&s===("p1"===e?1:8)&&(5===o&&(i.containsX(t,1)&&3===a||i.containsX(t,8)&&7===a)||i.containsX(t,a))}function l(e,t){const n="p1"===t?"1":"8",r=[];for(const[o,s]of e)o[1]===n&&s&&s.playerIndex===t&&"r-piece"===s.role&&r.push(i.key2pos(o)[0]);return r}n.loachecker=(e,t,n,i)=>s(e,t,n,i)||a(e,t,n,i);const p=(e,t,n,i)=>r(e,n)<2&&r(t,i)<2;function d(e,t,n){return(r,o,s,a)=>p(r,o,s,a)||n&&o===a&&o===("p1"===e?1:8)&&i.containsX(t,s)}const u=(e,t,n,i)=>{const o=r(e,n),s=r(t,i);return 1===o&&0===s||0===o&&1===s},f=(e,t,n,i)=>r(e,n)===r(t,i)&&1===r(e,n),h=(e,t,i,r)=>s(e,t,i,r)||(0,n.knight)(e,t,i,r),m=(e,t,i,r)=>a(e,t,i,r)||(0,n.knight)(e,t,i,r),g=(e,t,i,r)=>s(e,t,i,r)||a(e,t,i,r)||(0,n.knight)(e,t,i,r),b=(e,t,i,r)=>p(e,t,i,r)||(0,n.knight)(e,t,i,r);function v(e){return(t,n,i,o)=>r(t,i)<2&&("p1"===e?o===n+1||n<=3&&o===n+2&&t===i:o===n-1||n>=8&&o===n-2&&t===i)}function k(e){return(t,n,i,r)=>i===t&&("p1"===e?r>n:r<n)}function y(e){return(t,n,i,r)=>f(t,n,i,r)||t===i&&("p1"===e?r===n+1:r===n-1)}function w(e){return(t,n,i,o)=>u(t,n,i,o)||r(t,i)<2&&("p1"===e?o===n+1:o===n-1)}function P(e){return(t,n,i,r)=>i===t&&("p1"===e?r===n+1:r===n-1)}function x(e){return(t,n,i,r)=>(i===t-1||i===t+1)&&("p1"===e?r===n+2:r===n-2)}const I=(e,t,n,i)=>a(e,t,n,i)||f(e,t,n,i),C=(e,t,n,i)=>s(e,t,n,i)||u(e,t,n,i);function M(e,t){const n=Math.floor((e.width+1)/2),i="p1"===t?1:e.height-2;return[[n-1,i+2],[n,i+2],[n+1,i+2],[n-1,i+1],[n,i+1],[n+1,i+1],[n-1,i],[n,i],[n+1,i]]}function D(e){return(t,n,i,o)=>i===t&&("p1"===e?o===n+1:o===n-1)||o===n&&r(t,i)<2}function A(e){return(t,n,i,o)=>((e,t,n,i)=>{const o=r(e,n);return o===r(t,i)&&2===o})(t,n,i,o)&&("p1"===e?o<6:o>5)}function S(e,t){const n=M(t,e);return(e,t,i,r)=>u(e,t,i,r)&&n.some((e=>e[0]===i&&e[1]===r))}const O=(e,t,n,i)=>r(e,n)===r(t,i)&&r(e,n)<3,q=(e,t,n,i)=>{const o=r(e,n),s=r(t,i);return 2===o&&3===s||3===o&&2===s};const K=(e,t,n,i)=>{const o=r(e,n),s=r(t,i);return!(1!==o&&2!==o||1!==s&&2!==s)},E=(e,t,n,i)=>{const o=r(e,n),s=r(t,i);return 0===o&&(2===s||3===s)||0===s&&(2===o||3===o)||o===s&&(2===o||3===o)},N=(e,t,n,i)=>{const o=r(e,n),s=r(t,i);return 1===o||1===s||2===o&&(0===s||2===s)||0===o&&2===s},B=(e,t,n,i)=>{const o=r(e,n),s=r(t,i);return o<3&&(s<2||2===s&&0===o)},T=(e,t,i,o)=>{const s=r(e,i),a=r(t,o);return(0,n.knight)(e,t,i,o)||1===s&&3===a||3===s&&1===a},F=(e,t,i,r)=>(0,n.knight)(e,t,i,r)||(0,n.queen)(e,t,i,r),U=(e,t,n,i)=>{const o=r(e,n),s=r(t,i);return o===s&&o<4||0===s&&2===o||2===s&&o<2},_=(e,t,n,i)=>{const o=r(e,n),s=r(t,i);return o<3&&s<3&&!(1===o&&0===s)&&!(0===o&&1===s)};const R=(e,t,n,i)=>p(e,t,n,i)&&i!==t;function j(e){return(t,r,o,s)=>{if(o>t&&r===s)for(let n=1;t+n<o;n++){const r=i.pos2key([t+n,s]);if(e.has(r))return!1}if(o<t&&r===s)for(let n=1;t-n>o;n++){const r=i.pos2key([t-n,s]);if(e.has(r))return!1}if(s>r&&t===o)for(let n=1;r+n<s;n++){const t=i.pos2key([o,r+n]);if(e.has(t))return!1}if(s<r&&t===o)for(let n=1;r-n>s;n++){const t=i.pos2key([o,r-n]);if(e.has(t))return!1}if(o>t&&s>r)for(let n=1;t+n<o;n++){const o=i.pos2key([t+n,r+n]);if(e.has(o))return!1}if(o<t&&s<r)for(let n=1;t-n>o;n++){const o=i.pos2key([t-n,r-n]);if(e.has(o))return!1}if(o<t&&s>r)for(let n=1;t-n>o;n++){const o=i.pos2key([t-n,r+n]);if(e.has(o))return!1}if(o>t&&s<r)for(let n=1;t+n<o;n++){const o=i.pos2key([t+n,r-n]);if(e.has(o))return!1}return(0,n.queen)(t,r,o,s)&&function(e){return(t,n,r,o)=>{const s=i.pos2key([r,o]);return!e.has(s)}}(e)(t,r,o,s)}}const L=(e,t,n,i)=>!1;n.premove=function(e,t,$,z,V,G){const W=e.get(t),X=W.role,H=W.playerIndex;if(!W)return[];const Y=i.key2pos(t);let Z;switch(V){case"xiangqi":case"manchu":switch(X){case"p-piece":Z=function(e){return(t,n,i,o)=>i===t&&("p1"===e?o===n+1:o===n-1)||o===n&&r(t,i)<2&&("p1"===e?n>5:n<6)}(H);break;case"c-piece":case"r-piece":Z=a;break;case"n-piece":Z=n.knight;break;case"b-piece":Z=A(H);break;case"a-piece":Z=function(e,t){const n=M(t,e);return(e,t,i,r)=>f(e,t,i,r)&&n.some((e=>e[0]===i&&e[1]===r))}(H,z);break;case"k-piece":Z=S(H,z);break;case"m-piece":Z=m}break;case"janggi":switch(W.role){case"p-piece":Z=function(e,t){const n=M(t,i.opposite(e));return(t,i,o,s)=>{let a;switch(n.findIndex((e=>e[0]===t&&e[1]===i))){case 0:a=(t,n,i,r)=>i===t+1&&"p2"===e&&r===n-1;break;case 2:a=(t,n,i,r)=>i===t-1&&"p2"===e&&r===n-1;break;case 4:a=(t,n,i,o)=>1===r(t,i)&&("p1"===e?o===n+1:o===n-1);break;case 6:a=(t,n,i,r)=>i===t+1&&"p1"===e&&r===n+1;break;case 8:a=(t,n,i,r)=>i===t-1&&"p1"===e&&r===n+1;break;default:a=()=>!1}return o===t&&("p1"===e?s===i+1:s===i-1)||s===i&&r(t,o)<2||a(t,i,o,s)}}(H,z);break;case"c-piece":case"r-piece":Z=function(e){const t=M(e,"p1"),n=M(e,"p2");return(e,i,o,s)=>{let c;const l=t.findIndex((t=>t[0]===e&&t[1]===i)),p=n.findIndex((t=>t[0]===e&&t[1]===i)),d=-1!==l?l:p,u=r(e,o),h=r(i,s);switch(d){case 0:c=(e,t,n,i)=>u===h&&n>e&&n<=e+2&&i<t&&i>=t-2;break;case 2:c=(e,t,n,i)=>u===h&&n<e&&n>=e-2&&i<t&&i>=t-2;break;case 4:c=f;break;case 6:c=(e,t,n,i)=>u===h&&n>e&&n<=e+2&&i>t&&i<=t+2;break;case 8:c=(e,t,n,i)=>u===h&&n<e&&n>=e-2&&i>t&&i<=t+2;break;default:c=()=>!1}return a(e,i,o,s)||c(e,i,o,s)}}(z);break;case"n-piece":Z=n.knight;break;case"b-piece":Z=q;break;case"a-piece":case"k-piece":Z=function(e,t){const n=M(t,e);return(e,t,i,r)=>{let o;switch(n.findIndex((n=>n[0]===e&&n[1]===t))){case 0:o=(e,t,n,i)=>n===e+1&&i===t-1;break;case 2:o=(e,t,n,i)=>n===e-1&&i===t-1;break;case 4:o=f;break;case 6:o=(e,t,n,i)=>n===e+1&&i===t+1;break;case 8:o=(e,t,n,i)=>n===e-1&&i===t+1;break;default:o=()=>!1}return(u(e,t,i,r)||o(e,t,i,r))&&n.some((e=>e[0]===i&&e[1]===r))}}(H,z)}break;case"minixiangqi":switch(W.role){case"p-piece":Z=D(H);break;case"c-piece":case"r-piece":Z=a;break;case"n-piece":Z=n.knight;break;case"k-piece":Z=S(H,z)}break;case"shogi":case"minishogi":case"gorogoro":switch(W.role){case"p-piece":Z=P(H);break;case"l-piece":Z=k(H);break;case"n-piece":Z=x(H);break;case"k-piece":Z=p;break;case"s-piece":Z=y(H);break;case"pp-piece":case"pl-piece":case"pn-piece":case"ps-piece":case"g-piece":Z=w(H);break;case"b-piece":Z=s;break;case"r-piece":Z=a;break;case"pr-piece":Z=I;break;case"pb-piece":Z=C}break;case"kyotoshogi":switch(W.role){case"l-piece":Z=k(H);break;case"pl-piece":Z=w(H);break;case"s-piece":Z=y(H);break;case"ps-piece":Z=s;break;case"n-piece":Z=x(H);break;case"pn-piece":Z=w(H);break;case"p-piece":Z=P(H);break;case"pp-piece":Z=a;break;case"k-piece":Z=p}break;case"dobutsu":switch(W.role){case"c-piece":Z=P(H);break;case"e-piece":Z=f;break;case"g-piece":Z=u;break;case"l-piece":Z=p;break;case"pc-piece":Z=w(H)}break;case"torishogi":switch(X){case"s-piece":Z=P(H);break;case"ps-piece":Z=function(e){return(t,n,i,o)=>{const s=r(t,i);return"p1"===e?2===s&&o===n+2||0===s&&o===n-2:2===s&&o===n-2||0===s&&o===n+2}}(H);break;case"l-piece":Z=function(e){return(t,n,i,o)=>{const s=r(t,i),a=r(n,o);return"p1"===e?i===t&&o>n||s===a&&i>t&&o<n||i===t-1&&o===n-1:i===t&&o<n||s===a&&i<t&&o>n||i===t+1&&o===n+1}}(H);break;case"r-piece":Z=function(e){return(t,n,i,o)=>{const s=r(t,i),a=r(n,o);return"p1"===e?i===t&&o>n||s===a&&i<t&&o<n||i===t+1&&o===n-1:i===t&&o<n||s===a&&i>t&&o>n||i===t-1&&o===n+1}}(H);break;case"p-piece":Z=function(e){return(t,n,i,o)=>{const s=r(t,i);return"p1"===e?i===t&&o===n+2||1===s&&o===n-1:i===t&&o===n-2||1===s&&o===n+1}}(H);break;case"c-piece":Z=R;break;case"f-piece":Z=function(e){return(t,n,i,r)=>"p1"===e?p(t,n,i,r)&&!(i===t&&r===n-1):p(t,n,i,r)&&!(i===t&&r===n+1)}(H);break;case"pf-piece":Z=function(e){return(t,n,i,o)=>{const s=r(t,i),a=r(n,o);return"p1"===e?p(t,n,i,o)||s===a&&(o>n||o<n&&a<=2)||i===t&&o<n:p(t,n,i,o)||s===a&&(o<n||o>n&&a<=2)||i===t&&o>n}}(H);break;case"k-piece":Z=p}break;case"makruk":case"makpong":case"sittuyin":case"cambodian":switch(X){case"p-piece":Z=o(H);break;case"r-piece":Z=a;break;case"n-piece":Z=n.knight;break;case"s-piece":Z=y(H);break;case"f-piece":case"m-piece":Z=f;break;case"k-piece":Z=p}break;case"grand":case"grandhouse":switch(X){case"p-piece":Z=v(H);break;case"r-piece":Z=a;break;case"n-piece":Z=n.knight;break;case"b-piece":Z=s;break;case"q-piece":Z=n.queen;break;case"c-piece":Z=m;break;case"a-piece":Z=h;break;case"k-piece":Z=p}break;case"amazons":switch(X){case"p-piece":Z=L;break;case"q-piece":Z=j(e)}break;case"shako":switch(X){case"p-piece":Z=v(H);break;case"c-piece":case"r-piece":Z=a;break;case"n-piece":Z=n.knight;break;case"b-piece":Z=s;break;case"q-piece":Z=n.queen;break;case"e-piece":Z=O;break;case"k-piece":Z=function(e,t,n){return(r,o,s,a)=>p(r,o,s,a)||n&&o===a&&o===("p1"===e?2:9)&&6===r&&(8===s&&i.containsX(t,9)||4===s&&i.containsX(t,2))}(H,function(e,t){const n="p1"===t?"2":"9",r=[];for(const[o,s]of e)o[1]===n&&s&&s.playerIndex===t&&"r-piece"===s.role&&r.push(i.key2pos(o)[0]);return r}(e,H),$)}break;case"shogun":switch(X){case"p-piece":Z=o(H);break;case"pp-piece":Z=p;break;case"r-piece":Z=a;break;case"pr-piece":Z=m;break;case"n-piece":Z=n.knight;break;case"pn-piece":Z=b;break;case"b-piece":Z=s;break;case"pb-piece":Z=h;break;case"f-piece":Z=f;break;case"pf-piece":Z=n.queen;break;case"k-piece":Z=c(H,l(e,H),$)}break;case"orda":case"ordamirror":switch(X){case"p-piece":Z=o(H);break;case"r-piece":Z=a;break;case"n-piece":Z=n.knight;break;case"b-piece":Z=s;break;case"q-piece":Z=n.queen;break;case"l-piece":Z=m;break;case"h-piece":Z=b;break;case"a-piece":Z=h;break;case"y-piece":Z=y(H);break;case"f-piece":Z=g;break;case"k-piece":Z=c(H,l(e,H),$)}break;case"synochess":switch(X){case"p-piece":Z=o(H);break;case"c-piece":case"r-piece":Z=a;break;case"n-piece":Z=n.knight;break;case"b-piece":Z=s;break;case"q-piece":Z=n.queen;break;case"s-piece":Z=D(H);break;case"e-piece":Z=O;break;case"a-piece":Z=p;break;case"k-piece":Z=c(H,l(e,H),$&&"p1"===H)}break;case"musketeer":switch(X){case"p-piece":Z=o(H);break;case"r-piece":Z=a;break;case"n-piece":Z=n.knight;break;case"b-piece":Z=s;break;case"q-piece":Z=n.queen;break;case"l-piece":Z=K;break;case"o-piece":Z=B;break;case"u-piece":Z=T;break;case"d-piece":Z=F;break;case"c-piece":Z=m;break;case"a-piece":Z=h;break;case"e-piece":Z=N;break;case"h-piece":Z=E;break;case"f-piece":Z=U;break;case"s-piece":Z=_;break;case"k-piece":Z=c(H,l(e,H),$)}break;case"hoppelpoppel":switch(X){case"p-piece":Z=o(H);break;case"r-piece":Z=a;break;case"n-piece":case"b-piece":Z=h;break;case"q-piece":Z=n.queen;break;case"k-piece":Z=c(H,l(e,H),$)}break;case"shinobi":switch(X){case"p-piece":Z=o(H);break;case"pl-piece":case"r-piece":Z=a;break;case"ph-piece":case"n-piece":Z=n.knight;break;case"pm-piece":case"b-piece":Z=s;break;case"q-piece":Z=n.queen;break;case"pp-piece":case"c-piece":Z=p;break;case"l-piece":Z=k(H);break;case"h-piece":Z=x(H);break;case"m-piece":Z=f;break;case"d-piece":Z=I;break;case"j-piece":Z=h;break;case"k-piece":Z=c(H,l(e,H),$)}break;case"empire":switch(X){case"p-piece":Z=o(H);break;case"s-piece":Z=D(H);break;case"r-piece":Z=a;break;case"n-piece":Z=n.knight;break;case"b-piece":Z=s;break;case"d-piece":case"t-piece":case"c-piece":case"q-piece":Z=n.queen;break;case"e-piece":Z=g;break;case"k-piece":Z=c(H,l(e,H),$)}break;case"capablanca":case"capahouse":switch(X){case"p-piece":Z=o(H);break;case"r-piece":Z=a;break;case"n-piece":Z=n.knight;break;case"b-piece":Z=s;break;case"q-piece":Z=n.queen;break;case"c-piece":Z=m;break;case"a-piece":Z=h;break;case"k-piece":Z=G?d(H,l(e,H),$):function(e,t,n){return(r,o,s,a)=>p(r,o,s,a)||n&&o===a&&o===("p1"===e?1:8)&&6===r&&(9===s&&i.containsX(t,10)||3===s&&i.containsX(t,1))}(H,l(e,H),$)}break;default:switch(X){case"p-piece":Z=o(H);break;case"r-piece":Z=a;break;case"n-piece":Z=n.knight;break;case"b-piece":Z=s;break;case"q-piece":Z=n.queen;break;case"e-piece":case"c-piece":Z=m;break;case"h-piece":case"a-piece":Z=h;break;case"k-piece":Z=G?d(H,l(e,H),$):c(H,l(e,H),$);break;case"l-piece":Z=n.loachecker}}return i.allKeys(z).map(i.key2pos).filter((e=>(Y[0]!==e[0]||Y[1]!==e[1])&&Z(Y[0],Y[1],e[0],e[1]))).map(i.pos2key)}},{"./util":20}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.updateBounds=n.render=void 0;const i=e("./util"),r=e("./board"),o=e("./transformations");function s(e){return"PIECE"===e.tagName}function a(e){return"SQUARE"===e.tagName}function c(e,t){for(const n of t)e.dom.elements.board.removeChild(n)}function l(e,t,n,i){let r=2+((e=o.mapToP1[t](e,i))[1]-1)*i.height+(i.width-e[0]);return n&&(r=67-r),r+""}function p(e,t,n,i,r){const o=e.promoted?"promoted ":"",s=e.playerIndex===t&&n===t||e.playerIndex!==t&&n!==t?"ally":"enemy",a="backgammon"===i||"nackgammon"===i?d(r,n):"";return`${e.playerIndex} ${o}${e.role} ${s}${a}`}function d(e,t){const n=(0,i.key2pos)(e),r=n[0]<=6?"left":"right";return` ${"p1"===t?n[1]<=1?"bottom":"top":n[1]<=1?"top":"bottom"} ${r}`}function u(e,t,n){const i=e.get(t);i?e.set(t,`${i} ${n}`):e.set(t,n)}function f(e,t,n){const i=e.get(t);i?i.push(n):e.set(t,[n])}function h(e,t,n){switch(e){case"togyzkumalak":return"1"===t[1]?" p1":" p2";case"nackgammon":case"backgammon":return d(t,n);default:return""}}n.render=function(e){const t=e.orientation,n=(0,r.p1Pov)(e),o=e.dom.relative?i.posToTranslateRel:(0,i.posToTranslateAbs)(e.dom.bounds(),e.dimensions,e.variant),d=e.dom.relative?i.translateRel:i.translateAbs,m=e.dom.elements.board,g=e.pieces,b=e.pocketPieces,v=e.animation.current,k=v?v.plan.anims:new Map,y=v?v.plan.fadings:new Map,w=e.draggable.current,P=function(e){var t,n,r,o;const s=new Map;if(e.lastMove&&e.highlight.lastMove){let t=!0;for(const n of e.lastMove)"a0"!==n?t?(u(s,n,"last-move from"+h(e.variant,n,e.orientation)),t=!1):u(s,n,"last-move to"+h(e.variant,n,e.orientation)):t=!1}e.check&&e.highlight.check&&u(s,e.check,"check");if(e.selectOnly){for(const t of e.selectedPieces.keys())u(s,t,"selected");if(e.variant&&["go9x9","go13x13","go19x19"].includes(e.variant)){const t=(0,i.calculatePlayerEmptyAreas)(e.pieces,e.dimensions,e.selectedPieces);for(const[e,n]of t)u(s,e,"area "+n)}}if(e.selected){if(u(s,e.selected,"selected"+h(e.variant,e.selected,e.orientation)),e.movable.showDests){const n=null===(t=e.movable.dests)||void 0===t?void 0:t.get(e.selected);if(n)for(const t of n)u(s,t,"move-dest"+(e.pieces.has(t)?" oc":"")+h(e.variant,t,e.orientation));const i=e.premovable.dests;if(i)for(const t of i)u(s,t,"premove-dest"+(e.pieces.has(t)?" oc":"")+h(e.variant,t,e.orientation))}}else if(e.dropmode.active||"a0"===(null===(n=e.draggable.current)||void 0===n?void 0:n.orig)){const t=e.dropmode.active?e.dropmode.piece:null===(r=e.draggable.current)||void 0===r?void 0:r.piece;if(t){if(e.dropmode.showDropDests){const n=null===(o=e.dropmode.dropDests)||void 0===o?void 0:o.get(t.role);if(n)for(const e of n)u(s,e,"move-dest")}if(e.predroppable.showDropDests){const t=e.predroppable.dropDests;if(t)for(const n of t)u(s,n,"premove-dest"+(e.pieces.has(n)?" oc":""))}}}const a=e.premovable.current;if(a)for(const i of a)u(s,i,"current-premove");else e.predroppable.current&&u(s,e.predroppable.current.key,"current-premove");const c=e.exploding;if(c)for(const i of c.keys)u(s,i,"exploding"+c.stage);return s}(e),x=new Set,I=new Set,C=new Map,M=new Map;let D,A,S,O,q,K,E,N,B,T;for(A=m.firstChild;A;){if(D=A.cgKey,s(A))if(S=g.get(D),q=k.get(D),K=y.get(D),O=A.cgPiece,!A.cgDragging||w&&w.orig===D||(A.classList.remove("dragging"),d(A,o((0,i.key2pos)(D),t,e.dimensions,e.variant)),A.cgDragging=!1),!K&&A.cgFading&&(A.cgFading=!1,A.classList.remove("fading")),S){if(q&&A.cgAnimating&&O===p(S,e.myPlayerIndex,e.orientation,e.variant,D)){const n=(0,i.key2pos)(D);n[0]+=q[2],n[1]+=q[3],A.classList.add("anim"),d(A,o(n,t,e.dimensions,e.variant))}else A.cgAnimating&&(A.cgAnimating=!1,A.classList.remove("anim"),d(A,o((0,i.key2pos)(D),t,e.dimensions,e.variant)),e.addPieceZIndex&&(A.style.zIndex=l((0,i.key2pos)(D),t,n,e.dimensions)));O!==p(S,e.myPlayerIndex,e.orientation,e.variant,D)||K&&A.cgFading?K&&O===p(K,e.myPlayerIndex,e.orientation,e.variant,D)?(A.classList.add("fading"),A.cgFading=!0):f(C,O,A):x.add(D)}else f(C,O,A);else if(a(A)){const e=A.className;P.get(D)===e?I.add(D):M.has(e)?f(M,e,A):M.set(e,[A])}A=A.nextSibling}for(const[r,s]of P)if(!I.has(r)){B=M.get(s),T=B&&B.pop();const n=o((0,i.key2pos)(r),t,e.dimensions,e.variant);if(T)T.cgKey=r,d(T,n);else{const e=(0,i.createEl)("square",s);e.cgKey=r,d(e,n),m.insertBefore(e,m.firstChild)}}for(const[r,s]of g)if(q=k.get(r),!x.has(r))if(E=C.get(p(s,e.myPlayerIndex,e.orientation,e.variant,r)),N=E&&E.pop(),N){N.cgKey=r,N.cgFading&&(N.classList.remove("fading"),N.cgFading=!1);const s=(0,i.key2pos)(r);e.addPieceZIndex&&(N.style.zIndex=l(s,t,n,e.dimensions)),q&&(N.cgAnimating=!0,N.classList.add("anim"),s[0]+=q[2],s[1]+=q[3]),d(N,o(s,t,e.dimensions,e.variant))}else{const a=p(s,e.myPlayerIndex,e.orientation,e.variant,r),c=(0,i.createEl)("piece",a),u=(0,i.key2pos)(r);c.cgPiece=a,c.cgKey=r,q&&(c.cgAnimating=!0,u[0]+=q[2],u[1]+=q[3]),d(c,o(u,t,e.dimensions,e.variant)),e.addPieceZIndex&&(c.style.zIndex=l(u,t,n,e.dimensions)),m.appendChild(c)}for(const r of b){const t="p1"===r.playerIndex?"a1":"a2",n=p(r,e.myPlayerIndex,e.orientation,e.variant,t),o=(0,i.createEl)("piece","pocket "+n);o.cgPiece=n,o.cgKey="p1"===e.orientation?"a2":"a1",m.appendChild(o)}for(const i of C.values())c(e,i);for(const i of M.values())c(e,i)},n.updateBounds=function(e){if(e.dom.relative)return;const t=e.orientation,n=(0,i.posToTranslateAbs)(e.dom.bounds(),e.dimensions,e.variant);let r=e.dom.elements.board.firstChild;for(;r;)(s(r)&&!r.cgAnimating||a(r))&&(0,i.translateAbs)(r,n((0,i.key2pos)(r.cgKey),t)),r=r.nextSibling}},{"./board":3,"./transformations":18,"./util":20}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.defaults=void 0;const i=e("./fen"),r=e("./util");n.defaults=function(){return{pieces:i.read(i.initial,{width:8,height:8},"chess"),pocketPieces:i.readPocket(i.initial,"chess"),orientation:"p1",myPlayerIndex:"p1",startPlayerIndex:"p1",turnPlayerIndex:"p1",coordinates:!0,boardScores:!1,dice:[],canUndo:!1,showUndoButton:!1,gameButtonsActive:!0,autoCastle:!0,selectedPieces:new Map,viewOnly:!1,selectOnly:!1,disableContextMenu:!1,resizable:!0,addPieceZIndex:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,playerIndex:"both",showDests:!0,events:{},rookCastle:!0},liftable:{events:{}},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,showDropDests:!0,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,centerPiece:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1,showDropDests:!0},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://playstrategy.org/assets/piece/cburnett/"},prevSvgHash:""},hold:(0,r.timer)(),dimensions:{width:8,height:8},variant:"chess",chess960:!1,notation:0,onlyDropsVariant:!1,singleClickMoveVariant:!1}}},{"./fen":11,"./util":20}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.setAttributes=n.renderSvg=n.createElement=void 0;const i=e("./util"),r=e("./transformations");function o(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function s(e,t,n,i,r){const o=e.dom.bounds(),s=new Map,a=[];for(const p of t)s.set(p.hash,!1);let c,l=r.firstChild;for(;l;)c=l.getAttribute("cgHash"),s.has(c)?s.set(c,!0):a.push(l),l=l.nextSibling;for(const p of a)r.removeChild(p);for(const d of t)s.get(d.hash)||r.appendChild(p(e,d,n,i,o))}function a({orig:e,dest:t,brush:n,piece:i,modifiers:r,customSvg:o},s,a,p){return[p.width,p.height,a,e,t,n,t&&(s.get(t)||0)>1,i&&c(i),r&&(d=r,""+(d.lineWidth||"")),o&&l(o)].filter((e=>e)).join(",");var d}function c(e){return[e.playerIndex,e.role,e.scale].filter((e=>e)).join(",")}function l(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)>>>0;return"custom-"+t.toString()}function p(e,{shape:t,current:n,hash:r},s,a,c){let l;if(t.customSvg){const n=f((0,i.key2pos)(t.orig),e.orientation,e.dimensions);l=function(e,t,n,i){const{width:r,height:s}=n,a=r/i.width,c=s/i.height,l=(t[0]-1)*a,p=(i.height-t[1])*c,d=u(o("g"),{transform:`translate(${l},${p})`}),f=u(o("svg"),{width:a,height:c,viewBox:"0 0 100 100"});return d.appendChild(f),f.innerHTML=e,d}(t.customSvg,n,c,e.dimensions)}else if(t.piece)l=function(e,t,n,i,r,s,a){const c=b(t,i,r),l=i.width/r.width*(n.scale||1),p=i.height/r.height*(n.scale||1),d=function(e,t){switch(e){case"shogi":switch(t.role){case"pp-piece":return"0TO";case"pl-piece":return"0NY";case"pn-piece":return"0NK";case"ps-piece":return"0NG";case"pr-piece":return"0RY";case"pb-piece":return"0UM";case"p-piece":return"0FU";case"l-piece":return"0KY";case"n-piece":return"0KE";case"s-piece":return"0GI";case"r-piece":return"0HI";case"b-piece":return"0KA";case"g-piece":return"0KI";case"k-piece":return"p1"===t.playerIndex?"0GY":"0OU";default:return""}case"xiangqi":return("p1"===t.playerIndex?"R":"B")+t.role[0].toUpperCase();case"flipello10":case"flipello":case"linesOfAction":case"go9x9":case"go13x13":case"go19x19":return("p1"===t.playerIndex?"b":"w")+t.role[0].toUpperCase();case"oware":case"togyzkumalak":return t.role[0].split("-")[0].substring(1);case"nackgammon":case"backgammon":return("p1"===t.playerIndex?"w":"b")+t.role[0].split("-")[0].substring(1);default:return("p1"===t.playerIndex?"w":"b")+t.role[0].toUpperCase()}}(a,n),f=e.endsWith("/")?e.slice("https://playstrategy.org".length)+d+".svg":e,h=n.playerIndex===s?"ally":"enemy";return u(o("image"),{className:`${n.role} ${n.playerIndex} ${h}`,x:c[0]-l/2,y:c[1]-p/2,width:l,height:p,href:f})}(e.drawable.pieces.baseUrl,f((0,i.key2pos)(t.orig),e.orientation,e.dimensions),t.piece,c,e.dimensions,e.myPlayerIndex,e.variant);else{const r=f((0,i.key2pos)(t.orig),e.orientation,e.dimensions);if(t.orig&&t.dest){let p=s[t.brush];t.modifiers&&(p=h(p,t.modifiers)),l=function(e,t,n,i,r,s,a){const c=function(e,t,n){return(t?20:10)/(64*n.width)*e.width}(s,r&&!i,a),l=b(t,s,a),p=b(n,s,a),d=p[0]-l[0],f=p[1]-l[1],h=Math.atan2(f,d),v=Math.cos(h)*c,k=Math.sin(h)*c;return u(o("line"),{stroke:e.color,"stroke-width":m(e,i,s,a),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:g(e,i),x1:l[0],y1:l[1],x2:p[0]-v,y2:p[1]-k})}(p,r,f((0,i.key2pos)(t.dest),e.orientation,e.dimensions),n,(a.get(t.dest)||0)>1,c,e.dimensions)}else l=function(e,t,n,i,r){const s=b(t,i,r),a=function(e,t){const n=e.width/(64*t.width);return[3*n,4*n]}(i,r),c=(i.width+i.height)/(2*(r.height+r.width));return u(o("circle"),{stroke:e.color,"stroke-width":a[n?0:1],fill:"none",opacity:g(e,n),cx:s[0],cy:s[1],r:c-a[1]/2})}(s[t.brush],r,n,c,e.dimensions)}return l.setAttribute("cgHash",r),l}function d(e){const t=u(o("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return t.appendChild(u(o("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function u(e,t){for(const n in t)e.setAttribute(n,t[n]);return e}function f(e,t,n){return r.mapToP1Inverse[t](e,n)}function h(e,t){return{color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter((e=>e)).join("")}}function m(e,t,n,i){return(e.lineWidth||10)*(t?.85:1)/(64*i.width)*n.width}function g(e,t){return(e.opacity||1)*(t?.9:1)}function b(e,t,n){return[(e[0]-.5)*t.width/n.width,(n.height+.5-e[1])*t.height/n.height]}n.createElement=o,n.renderSvg=function(e,t,n){const i=e.drawable,r=i.current,o=r&&r.mouseSq?r:void 0,c=new Map,l=e.dom.bounds();for(const s of i.shapes.concat(i.autoShapes).concat(o?[o]:[]))s.dest&&c.set(s.dest,(c.get(s.dest)||0)+1);const p=i.shapes.concat(i.autoShapes).map((e=>({shape:e,current:!1,hash:a(e,c,!1,l)})));o&&p.push({shape:o,current:!0,hash:a(o,c,!0,l)});const u=p.map((e=>e.hash)).join(";");if(u===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=u;const f=t.querySelector("defs"),m=t.querySelector("g"),g=n.querySelector("g");!function(e,t,n){const i=new Map;let r;for(const a of t)a.shape.dest&&(r=e.brushes[a.shape.brush],a.shape.modifiers&&(r=h(r,a.shape.modifiers)),i.set(r.key,r));const o=new Set;let s=n.firstChild;for(;s;)o.add(s.getAttribute("cgKey")),s=s.nextSibling;for(const[a,c]of i.entries())o.has(a)||n.appendChild(d(c))}(i,p,f),s(e,p.filter((e=>!e.shape.customSvg)),i.brushes,c,m),s(e,p.filter((e=>e.shape.customSvg)),i.brushes,c,g)},n.setAttributes=u},{"./transformations":18,"./util":20}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.translateBase=n.mapToP1Inverse=n.mapToP1=void 0,n.mapToP1={p1:(e,t)=>e,p2:(e,t)=>[t.width+1-e[0],t.height+1-e[1]],right:(e,t)=>[t.height+1-e[1],e[0]],left:(e,t)=>[e[1],t.width+1-e[0]],p1vflip:(e,t)=>[e[0],t.height+1-e[1]]},n.mapToP1Inverse={p1:(e,t)=>e,p2:(e,t)=>[t.width+1-e[0],t.height+1-e[1]],right:(e,t)=>[e[1],t.width+1-e[0]],left:(e,t)=>[t.width+1-e[0],e[1]],p1vflip:(e,t)=>[e[0],t.height+1-e[1]]},n.translateBase={p1:(e,t,n,i)=>[(e[0]-1)*t,(i.height-e[1])*n],p2:(e,t,n,i)=>[(i.width-e[0])*t,(e[1]-1)*n],right:(e,t,n,i)=>[(e[1]-1)*t,(e[0]-1)*n],left:(e,t,n,i)=>[(i.width-e[0])*t,(e[1]-1)*n],p1vflip:(e,t,n,i)=>[(e[0]-1)*t,(e[1]-1)*n]}},{}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.goVariants=n.xiangqiVariants=n.shogiVariants=n.stoneCounts=n.letters=n.ranks19=n.ranks10=n.ranks=n.files=n.playerIndexs=n.orientations=void 0,n.orientations=["p1","p2","left","right","p1vflip"],n.playerIndexs=["p1","p2"],n.files=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s"],n.ranks=["1","2","3","4","5","6","7","8","9",":"],n.ranks10=["1","2","3","4","5","6","7","8","9","10"],n.ranks19=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"],n.letters=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],n.stoneCounts=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48"],n.shogiVariants=["shogi","minishogi","kyotoshogi","dobutsu","gorogoro","torishogi"],n.xiangqiVariants=["xiangqi","minixiangqi","manchu","janggi"],n.goVariants=["go9x9","go13x13","go19x19"]},{}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.callUserFunction=n.backgammonPosDiff=n.calculateBackgammonScores=n.calculateGoScores=n.calculatePieceGroup=n.calculateAreas=n.calculateBorder=n.calculatePlayerEmptyAreas=n.computeSquareCenter=n.createEl=n.isRightButton=n.eventPosition=n.setVisible=n.translateRelAndRotate=n.translateRel=n.translateAbsAndRotate=n.translateAbs=n.posToTranslateRel=n.posToTranslateAbs=n.samePiece=n.distanceSq=n.containsX=n.isPlayerIndex=n.orientationForBackgammon=n.oppositeOrientationForBackgammon=n.orientationForLOA=n.oppositeOrientationForLOA=n.oppositeOrientationBG=n.oppositeOrientation=n.opposite=n.timer=n.memo=n.adjacentKeys=n.allPos=n.key2pos=n.pos2key=n.allKeys=n.invNRanks=n.NRanks=n.invRanks=n.playerIndexs=void 0;const i=e("./types"),r=e("./transformations");function o(e={width:8,height:8}){return Array.prototype.concat(...(t=e.width,i.files.slice(0,t)).map((t=>function(e){return i.ranks19.slice(0,e)}(e.height).map((e=>t+e)))));var t}function s(e){return i.files[e[0]-1]+i.ranks19[e[1]-1]}function a(e){return[e.charCodeAt(0)-96,parseInt(e.slice(1))]}n.playerIndexs=["p1","p2"],n.invRanks=[...i.ranks19].reverse(),n.NRanks=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],n.invNRanks=[19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1],n.allKeys=o,n.pos2key=s,n.key2pos=a;function c(e,t){const n=a(t);return[[0,1],[0,-1],[1,0],[-1,0]].map((e=>[n[0]+e[0],n[1]+e[1]])).filter((t=>t[0]>0&&t[0]<=e.width&&t[1]>0&&t[1]<=e.height)).map((e=>s(e)))}n.allPos=e=>o(e).map(a),n.adjacentKeys=c,n.memo=function(e){let t;const n=()=>(void 0===t&&(t=e()),t);return n.clear=()=>{t=void 0},n};n.timer=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}};n.opposite=e=>"p1"===e?"p2":"p1";const l={p1:"p2",p2:"p1",left:"right",right:"left",p1vflip:"p1"},p={p1:"p1vflip",p1vflip:"p1",p2:"p2",left:"left",right:"right"};n.oppositeOrientation=e=>l[e];n.oppositeOrientationBG=e=>p[e];const d={p1:"right",p2:"p1"};n.oppositeOrientationForLOA=e=>d[e];const u={p1:"p1",p2:"right"};n.orientationForLOA=e=>u[e];const f={p1:"p1vflip",p2:"p1"};n.oppositeOrientationForBackgammon=e=>f[e];const h={p1:"p1",p2:"p1vflip"};n.orientationForBackgammon=e=>h[e];n.isPlayerIndex=e=>"p1"===e||"p2"===e,n.containsX=function(e,t){return void 0!==e&&-1!==e.indexOf(t)};n.distanceSq=(e,t)=>{const n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i};n.samePiece=(e,t)=>e.role===t.role&&e.playerIndex===t.playerIndex;const m=(e,t,n,i,o)=>r.translateBase[t](e,n,i,o);n.posToTranslateAbs=(e,t,n)=>{const i=e.width/t.width*("backgammon"===n||"nackgammon"===n?.8:1),r=e.height/t.height;return(e,n)=>m(e,n,i,r,t)};n.posToTranslateRel=(e,t,n,i)=>m(e,t,100,"togyzkumalak"===i?150:"backgammon"===i||"nackgammon"===i?116:100,n);n.translateAbs=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`};n.translateAbsAndRotate=(e,t,n)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) rotate(${n}deg)`};n.translateRel=(e,t)=>{e.style.transform=`translate(${t[0]}%,${t[1]}%)`};n.translateRelAndRotate=(e,t,n)=>{e.style.transform=`translate(${t[0]}%,${t[1]}%) rotate(${n}deg)`};n.setVisible=(e,t)=>{e.style.visibility=t?"visible":"hidden"};n.eventPosition=e=>{var t;return e.clientX||0===e.clientX?[e.clientX,e.clientY]:(null===(t=e.targetTouches)||void 0===t?void 0:t[0])?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0};n.isRightButton=e=>2===e.buttons||2===e.button;function g(e,t,n){const i=o(t).filter((t=>!e.has(t)||n.has(t))),r=new Map;e.forEach(((e,t)=>{r.set(t,e)})),n.forEach(((e,t)=>{r.delete(t)}));const s=v(i,t),a=new Map;for(const o of s){const e=b(o,t),i=new Set(e.map((e=>{var t;return null===(t=r.get(e))||void 0===t?void 0:t.playerIndex})));if(1===i.size)for(const t of o)Array.from(n.keys()).includes(t)||a.set(t,i.has("p1")?"p1":"p2")}return a}function b(e,t){return e.flatMap((e=>c(t,e))).filter((t=>!e.includes(t)))}function v(e,t){return function e(n,i){const r=n.filter((e=>i.slice(0,1).flat().flatMap((e=>c(t,e))).includes(e))),o=0===r.length?[n.slice(0,1)].concat(i):[i.slice(0,1).flat().concat(r)].concat(i.slice(1)),s=n.filter((e=>!o.flat().includes(e)));return s.length>0?e(s,o):o}(e.slice(1),[e.slice(0,1)])}n.createEl=(e,t)=>{const n=document.createElement(e);return t&&(n.className=t),n},n.computeSquareCenter=function(e,t,n,i){const o=r.mapToP1Inverse[t](a(e),i);return[n.left+n.width*(o[0]-1+.5)/i.width,n.top+n.height*(i.height-(o[1]-1+.5))/i.height]},n.calculatePlayerEmptyAreas=g,n.calculateBorder=b,n.calculateAreas=v,n.calculatePieceGroup=function(e,t,n){return function i(r){const o=b(r,n).filter((n=>{var i,r;return t.get(n)&&(null===(i=t.get(n))||void 0===i?void 0:i.playerIndex)===(null===(r=t.get(e))||void 0===r?void 0:r.playerIndex)}));return o.length>0?i(r.concat(o)):r}([e])},n.calculateGoScores=function(e,t,n){let i=0,r=0;const s=new Map([...Array.from(t.entries())]);for(const[o,l]of e)s.delete(o);const a=g(s,n,new Map);for(const[o,l]of a)"p1"===l?i++:r++;const c=o(n).filter((n=>t.has(n)&&!e.has(n)));return i+=c.filter((e=>{var n;return"p1"===(null===(n=t.get(e))||void 0===n?void 0:n.playerIndex)})).length,r+=c.filter((e=>{var n;return"p2"===(null===(n=t.get(e))||void 0===n?void 0:n.playerIndex)})).length,{p1:i,p2:r}},n.calculateBackgammonScores=function(e,t,n){let i=0,r=0;for(const[o,s]of e){const e=a(o),t=1===e[1]?e[0]+n.width:n.width+1-e[0],c=s.role.split("-")[0].slice(1);if("p1"===s.playerIndex){const e=n.height*n.width+1-t;i+=parseInt(c,10)*e}else{const e=t;r+=parseInt(c,10)*e}}for(const o of t){const e=o.role.split("-")[0].slice(1);"p1"===o.playerIndex?i+=parseInt(e,10)*(n.height*n.width+1):r+=parseInt(e,10)*(n.height*n.width+1)}return{p1:i,p2:r}},n.backgammonPosDiff=function(e,t){const n=a(e)[0],i=a(e)[1],r=a(t)[0];return i===a(t)[1]?Math.abs(n-r):n+r-1},n.callUserFunction=function(e,...t){e&&setTimeout((()=>e(...t)),1)}},{"./transformations":18,"./types":19}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.renderWrap=void 0;const i=e("./util"),r=e("./types"),o=e("./svg");function s(e,t){const n=(0,i.createEl)("board-scores",t),r=(0,i.createEl)("board-score");return r.textContent=e,n.appendChild(r),n}function a(e,t){const n=(0,i.createEl)("board-scores",t);let r,o;for(const s of e){switch(r=(0,i.createEl)("position-score"),s){case"t":o=(0,i.createEl)("score","tuzdik"),r.appendChild(o);break;case"0":o=(0,i.createEl)("score","empty"),r.appendChild(o);break;default:{const e=(parseInt(s,10)%2==1?"odd":"")+(parseInt(s,10)>20?" abundance":"");o=(0,i.createEl)("score",e),o.textContent=s,r.appendChild(o)}}n.appendChild(r)}return n}function c(e,t){const n=(0,i.createEl)("coords",t);let r;for(const o of e)r=(0,i.createEl)("coord"),r.textContent=o,n.appendChild(r);return n}n.renderWrap=function(e,t,n){e.innerHTML="",e.classList.add("cg-wrap");for(const i of r.orientations)e.classList.toggle("orientation-"+i,t.orientation===i);e.classList.toggle("manipulable",!t.viewOnly);const l=(0,i.createEl)("cg-helper");e.appendChild(l);const p=(0,i.createEl)("cg-container");l.appendChild(p);const d=(0,i.createEl)("extension");p.appendChild(d);const u=(0,i.createEl)("cg-board");let f,h,m;if(p.appendChild(u),t.drawable.visible&&!n&&(f=(0,o.setAttributes)((0,o.createElement)("svg"),{class:"cg-shapes"}),f.appendChild((0,o.createElement)("defs")),f.appendChild((0,o.createElement)("g")),h=(0,o.setAttributes)((0,o.createElement)("svg"),{class:"cg-custom-svgs"}),h.appendChild((0,o.createElement)("g")),p.appendChild(f),p.appendChild(h)),t.coordinates){const e=" "+t.orientation,n=r.shogiVariants.includes(t.variant),i=r.xiangqiVariants.includes(t.variant);n?(p.appendChild(c(r.ranks.slice(0,t.dimensions.height).reverse(),"files"+e)),p.appendChild(c(r.ranks.slice(0,t.dimensions.width).reverse(),"ranks"+e))):6===t.notation?(p.appendChild(c(["0"].concat(r.ranks.slice(0,9).reverse()),"ranks"+e)),p.appendChild(c(r.ranks.slice(0,9),"files"+e))):i?"p1"===t.orientation?(p.appendChild(c(r.ranks19.slice(0,t.dimensions.width).reverse(),"files p1")),p.appendChild(c(r.ranks19.slice(0,t.dimensions.width).reverse(),"files p2"))):(p.appendChild(c(r.ranks19.slice(0,t.dimensions.width),"files p1")),p.appendChild(c(r.ranks19.slice(0,t.dimensions.width),"files p2"))):"flipello"===t.variant||"flipello10"===t.variant?(p.appendChild(c(r.ranks19.slice(0,t.dimensions.height).reverse(),"ranks"+e)),p.appendChild(c(r.files.slice(0,t.dimensions.width),"files"+e))):"oware"===t.variant?"p1"===t.orientation?(p.appendChild(c(r.files.slice(0,t.dimensions.width).map((e=>e.toUpperCase())),"files p1")),p.appendChild(c(r.files.slice(0,t.dimensions.width),"files p2"))):(p.appendChild(c(r.files.slice(0,t.dimensions.width).map((e=>e.toUpperCase())).reverse(),"files p1")),p.appendChild(c(r.files.slice(0,t.dimensions.width).reverse(),"files p2"))):"togyzkumalak"===t.variant?"p1"===t.orientation?(p.appendChild(c(r.ranks.slice(0,t.dimensions.width),"files p1")),p.appendChild(c(r.ranks.slice(0,t.dimensions.width),"files p2"))):(p.appendChild(c(r.ranks.slice(0,t.dimensions.width).reverse(),"files p1")),p.appendChild(c(r.ranks.slice(0,t.dimensions.width).reverse(),"files p2"))):"backgammon"===t.variant||"nackgammon"===t.variant?"p1"===t.orientation?"p1"===t.turnPlayerIndex?(p.appendChild(c(["13","14","15","16","17","18","","19","20","21","22","23","24"],"files p2")),p.appendChild(c(["1","2","3","4","5","6","","7","8","9","10","11","12"].reverse(),"files p1"))):(p.appendChild(c(["13","14","15","16","17","18","","19","20","21","22","23","24"],"files p1")),p.appendChild(c(["1","2","3","4","5","6","","7","8","9","10","11","12"].reverse(),"files p2"))):"p1"===t.turnPlayerIndex?(p.appendChild(c(["1","2","3","4","5","6","","7","8","9","10","11","12"].reverse(),"files p1")),p.appendChild(c(["13","14","15","16","17","18","","19","20","21","22","23","24"],"files p2"))):(p.appendChild(c(["1","2","3","4","5","6","","7","8","9","10","11","12"].reverse(),"files p2")),p.appendChild(c(["13","14","15","16","17","18","","19","20","21","22","23","24"],"files p1"))):(p.appendChild(c(r.ranks19.slice(0,t.dimensions.height),"ranks"+e)),p.appendChild(c(r.files.slice(0,t.dimensions.width),"files"+e)))}if(t.boardScores){const e=t.dimensions;if("togyzkumalak"===t.variant){const n=i.invNRanks.slice(-e.height).map((n=>i.NRanks.slice(0,e.width).map((e=>{const r=t.pieces.get((0,i.pos2key)([e,n]));return r?"t-piece"===r.role?"t":r.role.split("-")[0].substring(1):"0"}))));"p1"===t.orientation?(p.appendChild(a(n[1],"p1")),p.appendChild(a(n[0],"p2"))):(p.appendChild(a(n[1].reverse(),"p1")),p.appendChild(a(n[0].reverse(),"p2")))}else if("backgammon"===t.variant||"nackgammon"===t.variant){const e=(0,i.calculateBackgammonScores)(t.pieces,t.pocketPieces,t.dimensions);p.appendChild(s(e.p1.toString(),"p1")),p.appendChild(s(e.p2.toString(),"p2"))}else p.appendChild(s("0",t.orientation))}return t.dice.length>0&&(p.appendChild(function(e,t){const n=(0,i.createEl)("cg-dice",t),r=["one","two","three","four","five","six"];let o;for(const s of e)o=(0,i.createEl)("dice",r[s.value-1]+(s.isAvailable?" available":" unavailable")),n.appendChild(o);return n}(t.dice,t.turnPlayerIndex)),t.showUndoButton&&p.appendChild(function(e,t){const n=(0,i.createEl)("cg-buttons",t),r=(0,i.createEl)("cg-button","undo "+(e?"available":"unavailable"));return r.textContent="UNDO",n.appendChild(r),n}(t.canUndo,t.turnPlayerIndex))),t.draggable.showGhost&&!n&&(m=(0,i.createEl)("piece","ghost"),(0,i.setVisible)(m,!1),p.appendChild(m)),{board:u,container:p,ghost:m,svg:f,customSvg:h}}},{"./svg":17,"./types":19,"./util":20}]},{},[12])(12)}));