var Chessground=function(){"use strict";function e(e){var t={exports:{}};return e(t,t.exports),t.exports}var t=e((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ranks=t.files=t.colors=t.orientations=void 0,t.orientations=["white","black","left","right"],t.colors=["white","black"],t.files=["a","b","c","d","e","f","g","h"],t.ranks=["1","2","3","4","5","6","7","8"]})),o=e((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.translateBase=t.mapToWhiteInverse=t.mapToWhite=void 0,t.mapToWhite={white:e=>e,black:e=>[7-e[0],7-e[1]],right:e=>[7-e[1],e[0]],left:e=>[e[1],7-e[0]]},t.mapToWhiteInverse={white:e=>e,black:e=>[7-e[0],7-e[1]],right:e=>[e[1],7-e[0]],left:e=>[7-e[0],e[1]]},t.translateBase={white:(e,t,o)=>[e[0]*t,(7-e[1])*o],black:(e,t,o)=>[(7-e[0])*t,e[1]*o],right:(e,t,o)=>[e[1]*t,e[0]*o],left:(e,t,o)=>[(7-e[0])*t,e[1]*o]}})),n=e((function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.computeSquareCenter=n.createEl=n.isRightButton=n.eventPosition=n.setVisible=n.translateRel=n.translateAbs=n.posToTranslateRel=n.posToTranslateAbs=n.samePiece=n.distanceSq=n.isColor=n.orientationForLOA=n.oppositeOrientationForLOA=n.oppositeOrientation=n.opposite=n.timer=n.memo=n.validPos=n.allPos=n.key2pos=n.pos2key=n.allKeys=n.invRanks=void 0,n.invRanks=[...t.ranks].reverse(),n.allKeys=Array.prototype.concat(...t.files.map((e=>t.ranks.map((t=>e+t)))));n.pos2key=e=>n.allKeys[8*e[0]+e[1]];n.key2pos=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],n.allPos=n.allKeys.map(n.key2pos);n.validPos=e=>e[0]>=0&&e[0]<8&&e[1]>=0&&e[1]<8,n.memo=function(e){let t;const o=()=>(void 0===t&&(t=e()),t);return o.clear=()=>{t=void 0},o};n.timer=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}};n.opposite=e=>"white"===e?"black":"white";const r={white:"black",black:"white",left:"right",right:"left"};n.oppositeOrientation=e=>r[e];const s={white:"right",black:"white"};n.oppositeOrientationForLOA=e=>s[e];const i={white:"white",black:"right"};n.orientationForLOA=e=>i[e];n.isColor=e=>"white"===e||"black"===e;n.distanceSq=(e,t)=>{const o=e[0]-t[0],n=e[1]-t[1];return o*o+n*n};n.samePiece=(e,t)=>e.role===t.role&&e.color===t.color;const a=(e,t,n,r)=>o.translateBase[t](e,n,r);n.posToTranslateAbs=e=>{const t=e.width/8,o=e.height/8;return(e,n)=>a(e,n,t,o)};n.posToTranslateRel=(e,t)=>a(e,t,100,100);n.translateAbs=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`};n.translateRel=(e,t)=>{e.style.transform=`translate(${t[0]}%,${t[1]}%)`};n.setVisible=(e,t)=>{e.style.visibility=t?"visible":"hidden"};n.eventPosition=e=>{var t;return e.clientX||0===e.clientX?[e.clientX,e.clientY]:(null===(t=e.targetTouches)||void 0===t?void 0:t[0])?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0};n.isRightButton=e=>2===e.buttons||2===e.button;n.createEl=(e,t)=>{const o=document.createElement(e);return t&&(o.className=t),o},n.computeSquareCenter=function(e,t,r){const s=o.mapToWhiteInverse[t](n.key2pos(e));return[r.left+r.width*s[0]/8+r.width/16,r.top+r.height*(7-s[1])/8+r.height/16]}})),r=e((function(e,t){function o(e,t){return Math.abs(e-t)}Object.defineProperty(t,"__esModule",{value:!0}),t.premove=t.loachecker=t.queen=t.knight=void 0;t.knight=(e,t,n,r)=>{const s=o(e,n),i=o(t,r);return 1===s&&2===i||2===s&&1===i};const r=(e,t,n,r)=>o(e,n)===o(t,r),s=(e,t,o,n)=>e===o||t===n;t.queen=(e,t,o,n)=>r(e,t,o,n)||s(e,t,o,n);t.loachecker=(e,t,o,n)=>r(e,t,o,n)||s(e,t,o,n),t.premove=function(e,i,a){const c=e.get(i);if(!c)return[];const l=n.key2pos(i),d=c.role,u="pawn"===d?(p=c.color,(e,t,n,r)=>o(e,n)<2&&("white"===p?r===t+1||t<=1&&r===t+2&&e===n:r===t-1||t>=6&&r===t-2&&e===n)):"knight"===d?t.knight:"bishop"===d?r:"rook"===d?s:"queen"===d?t.queen:"loachecker"===d?t.loachecker:function(e,t,n){return(r,s,i,a)=>o(r,i)<2&&o(s,a)<2||n&&s===a&&s===("white"===e?0:7)&&(4===r&&(2===i&&t.includes(0)||6===i&&t.includes(7))||t.includes(i))}(c.color,function(e,t){const o="white"===t?"1":"8",r=[];for(const[s,i]of e)s[1]===o&&i.color===t&&"rook"===i.role&&r.push(n.key2pos(s)[0]);return r}(e,c.color),a);var p;return n.allPos.filter((e=>(l[0]!==e[0]||l[1]!==e[1])&&u(l[0],l[1],e[0],e[1]))).map(n.pos2key)}})),s=e((function(e,t){function s(e,...t){e&&setTimeout((()=>e(...t)),1)}function i(e,t){e.orientation=t,e.animation.current=e.draggable.current=e.selected=void 0}function a(e){e.premovable.current&&(e.premovable.current=void 0,s(e.premovable.events.unset))}function c(e){const t=e.predroppable;t.current&&(t.current=void 0,s(t.events.unset))}function l(e,t,o){const r=e.pieces.get(t),i=e.pieces.get(o);if(t===o||!r)return!1;const a=i&&i.color!==r.color?i:void 0;return o===e.selected&&g(e),s(e.events.move,t,o,a),function(e,t,o){if(!e.autoCastle)return!1;const r=e.pieces.get(t);if(!r||"king"!==r.role)return!1;const s=n.key2pos(t),i=n.key2pos(o);if(0!==s[1]&&7!==s[1]||s[1]!==i[1])return!1;4!==s[0]||e.pieces.has(o)||(6===i[0]?o=n.pos2key([7,i[1]]):2===i[0]&&(o=n.pos2key([0,i[1]])));const a=e.pieces.get(o);return!(!a||a.color!==r.color||"rook"!==a.role||(e.pieces.delete(t),e.pieces.delete(o),s[0]<i[0]?(e.pieces.set(n.pos2key([6,i[1]]),r),e.pieces.set(n.pos2key([5,i[1]]),a)):(e.pieces.set(n.pos2key([2,i[1]]),r),e.pieces.set(n.pos2key([3,i[1]]),a)),0))}(e,t,o)||(e.pieces.set(o,r),e.pieces.delete(t)),e.lastMove=[t,o],e.check=void 0,s(e.events.change),a||!0}function d(e,t,o,r){if(e.pieces.has(o)){if(!r)return!1;e.pieces.delete(o)}return s(e.events.dropNewPiece,t,o),e.pieces.set(o,t),e.lastMove=[o],e.check=void 0,s(e.events.change),e.movable.dests=void 0,e.turnColor=n.opposite(e.turnColor),!0}function u(e,t,o){const r=l(e,t,o);return r&&(e.movable.dests=void 0,e.turnColor=n.opposite(e.turnColor),e.animation.current=void 0),r}function p(e,t,o){if(h(e,t,o)){const n=u(e,t,o);if(n){const r=e.hold.stop();g(e);const i={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:r};return!0!==n&&(i.captured=n),s(e.movable.events.after,t,o,i),!0}}else if(function(e,t,o){return t!==o&&m(e,t)&&r.premove(e.pieces,t,e.premovable.castle).includes(o)}(e,t,o))return function(e,t,o,n){c(e),e.premovable.current=[t,o],s(e.premovable.events.set,t,o,n)}(e,t,o,{ctrlKey:e.stats.ctrlKey}),g(e),!0;return g(e),!1}function f(e,t){e.selected=t,m(e,t)?e.premovable.dests=r.premove(e.pieces,t,e.premovable.castle):e.premovable.dests=void 0}function g(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function v(e,t){const o=e.pieces.get(t);return!!o&&("both"===e.movable.color||e.movable.color===o.color&&e.turnColor===o.color)}function h(e,t,o){var n,r;return t!==o&&v(e,t)&&(e.movable.free||!!(null===(r=null===(n=e.movable.dests)||void 0===n?void 0:n.get(t))||void 0===r?void 0:r.includes(o)))}function m(e,t){const o=e.pieces.get(t);return!!o&&e.premovable.enabled&&e.movable.color===o.color&&e.turnColor!==o.color}function b(e){a(e),c(e),g(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.getSnappedKeyAtDomPos=t.getKeyAtDomPos=t.stop=t.cancelMove=t.playPredrop=t.playPremove=t.isDraggable=t.canMove=t.unselect=t.setSelected=t.selectSquare=t.dropNewPiece=t.userMove=t.baseNewPiece=t.baseMove=t.unsetPredrop=t.unsetPremove=t.setCheck=t.setPieces=t.reset=t.toggleOrientation=t.setOrientation=t.callUserFunction=void 0,t.callUserFunction=s,t.setOrientation=i,t.toggleOrientation=function(e){i(e,n.oppositeOrientation(e.orientation))},t.reset=function(e){e.lastMove=void 0,g(e),a(e),c(e)},t.setPieces=function(e,t){for(const[o,n]of t)n?e.pieces.set(o,n):e.pieces.delete(o)},t.setCheck=function(e,t){if(e.check=void 0,!0===t&&(t=e.turnColor),t)for(const[o,n]of e.pieces)"king"===n.role&&n.color===t&&(e.check=o)},t.unsetPremove=a,t.unsetPredrop=c,t.baseMove=l,t.baseNewPiece=d,t.userMove=p,t.dropNewPiece=function(e,t,o,n){const r=e.pieces.get(t);r&&(function(e,t,o){const n=e.pieces.get(t);return!(!n||t!==o&&e.pieces.has(o)||"both"!==e.movable.color&&(e.movable.color!==n.color||e.turnColor!==n.color))}(e,t,o)||n)?(e.pieces.delete(t),d(e,r,o,n),s(e.movable.events.afterNewPiece,r.role,o,{premove:!1,predrop:!1})):r&&function(e,t,o){const n=e.pieces.get(t),r=e.pieces.get(o);return!!n&&(!r||r.color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==n.role||"1"!==o[1]&&"8"!==o[1])&&e.movable.color===n.color&&e.turnColor!==n.color}(e,t,o)?function(e,t,o){a(e),e.predroppable.current={role:t,key:o},s(e.predroppable.events.set,t,o)}(e,r.role,o):(a(e),c(e)),e.pieces.delete(t),g(e)},t.selectSquare=function(e,t,o){if(s(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled)return g(e),void e.hold.cancel();if((e.selectable.enabled||o)&&e.selected!==t&&p(e,e.selected,t))return void(e.stats.dragged=!1)}(v(e,t)||m(e,t))&&(f(e,t),e.hold.start())},t.setSelected=f,t.unselect=g,t.canMove=h,t.isDraggable=function(e,t){const o=e.pieces.get(t);return!!o&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===o.color&&(e.turnColor===o.color||e.premovable.enabled))},t.playPremove=function(e){const t=e.premovable.current;if(!t)return!1;const o=t[0],n=t[1];let r=!1;if(h(e,o,n)){const t=u(e,o,n);if(t){const i={premove:!0};!0!==t&&(i.captured=t),s(e.movable.events.after,o,n,i),r=!0}}return a(e),r},t.playPredrop=function(e,t){const o=e.predroppable.current;let n=!1;if(!o)return!1;if(t(o)){d(e,{role:o.role,color:e.movable.color},o.key)&&(s(e.movable.events.afterNewPiece,o.role,o.key,{premove:!1,predrop:!0}),n=!0)}return c(e),n},t.cancelMove=b,t.stop=function(e){e.movable.color=e.movable.dests=e.animation.current=void 0,b(e)},t.getKeyAtDomPos=function(e,t,r){return e=[Math.floor(8*(e[0]-r.left)/r.width),7-Math.floor(8*(e[1]-r.top)/r.height)],e=o.mapToWhite[t](e),n.validPos(e)?n.pos2key(e):void 0},t.getSnappedKeyAtDomPos=function(e,t,o,s){const i=n.key2pos(e),a=n.allPos.filter((e=>r.queen(i[0],i[1],e[0],e[1])||r.knight(i[0],i[1],e[0],e[1]))),c=a.map((e=>n.computeSquareCenter(n.pos2key(e),o,s))).map((e=>n.distanceSq(t,e))),[,l]=c.reduce(((e,t,o)=>e[0]<t?e:[t,o]),[c[0],0]);return n.pos2key(a[l])}})),i=e((function(e,o){Object.defineProperty(o,"__esModule",{value:!0}),o.write=o.read=o.initial=void 0,o.initial="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR";const r={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king",l:"loachecker"},s={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k",loachecker:"l"};o.read=function(e){"start"===e&&(e=o.initial);const t=new Map;let s=7,i=0;for(const o of e)switch(o){case" ":return t;case"/":if(--s,s<0)return t;i=0;break;case"~":{const e=t.get(n.pos2key([i,s]));e&&(e.promoted=!0);break}default:{const e=o.charCodeAt(0);if(e<57)i+=e-48;else{const e=o.toLowerCase();t.set(n.pos2key([i,s]),{role:r[e],color:o===e?"black":"white"}),++i}}}return t},o.write=function(e){return n.invRanks.map((o=>t.files.map((t=>{const n=e.get(t+o);if(n){const e=s[n.role];return"white"===n.color?e.toUpperCase():e}return"1"})).join(""))).join("/").replace(/1{2,}/g,(e=>e.length.toString()))}})),a=e((function(e,t){function o(e,t){for(const r in t)n(e[r])&&n(t[r])?o(e[r],t[r]):e[r]=t[r]}function n(e){return"object"==typeof e}Object.defineProperty(t,"__esModule",{value:!0}),t.configure=void 0,t.configure=function(e,t){var n,r;if((null===(n=t.movable)||void 0===n?void 0:n.dests)&&(e.movable.dests=void 0),(null===(r=t.drawable)||void 0===r?void 0:r.autoShapes)&&(e.drawable.autoShapes=[]),o(e,t),t.fen&&(e.pieces=i.read(t.fen),e.drawable.shapes=[]),"check"in t&&s.setCheck(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&s.setSelected(e,e.selected),(!e.animation.duration||e.animation.duration<100)&&(e.animation.enabled=!1),!e.movable.rookCastle&&e.movable.dests){const t="white"===e.movable.color?"1":"8",o="e"+t,n=e.movable.dests.get(o),r=e.pieces.get(o);if(!n||!r||"king"!==r.role)return;e.movable.dests.set(o,n.filter((e=>!(e==="a"+t&&n.includes("c"+t)||e==="h"+t&&n.includes("g"+t)))))}}})),c=e((function(e,t){function o(e,t){const o=e(t);return t.dom.redraw(),o}function r(e,t){return{key:e,pos:n.key2pos(e),piece:t}}function s(e,t){return t.sort(((t,o)=>n.distanceSq(e.pos,t.pos)-n.distanceSq(e.pos,o.pos)))[0]}function i(e,t){const o=e.animation.current;if(void 0===o)return void(e.dom.destroyed||e.dom.redrawNow());const n=1-(t-o.start)*o.frequency;if(n<=0)e.animation.current=void 0,e.dom.redrawNow();else{const t=(r=n)<.5?4*r*r*r:(r-1)*(2*r-2)*(2*r-2)+1;for(const e of o.plan.anims.values())e[2]=e[0]*t,e[3]=e[1]*t;e.dom.redrawNow(!0),requestAnimationFrame(((t=performance.now())=>i(e,t)))}var r}Object.defineProperty(t,"__esModule",{value:!0}),t.render=t.anim=void 0,t.anim=function(e,t){return t.animation.enabled?function(e,t){const o=new Map(t.pieces),a=e(t),c=function(e,t){const o=new Map,i=[],a=new Map,c=[],l=[],d=new Map;let u,p,f;for(const[n,s]of e)d.set(n,r(n,s));for(const s of n.allKeys)u=t.pieces.get(s),p=d.get(s),u?p?n.samePiece(u,p.piece)||(c.push(p),l.push(r(s,u))):l.push(r(s,u)):p&&c.push(p);for(const r of l)p=s(r,c.filter((e=>n.samePiece(r.piece,e.piece)))),p&&(f=[p.pos[0]-r.pos[0],p.pos[1]-r.pos[1]],o.set(r.key,f.concat(f)),i.push(p.key));for(const n of c)i.includes(n.key)||a.set(n.key,n.piece);return{anims:o,fadings:a}}(o,t);if(c.anims.size||c.fadings.size){const e=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:c},e||i(t,performance.now())}else t.dom.redraw();return a}(e,t):o(e,t)},t.render=o})),l=e((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.clear=t.cancel=t.end=t.move=t.processDraw=t.start=void 0;const o=["green","red","blue","yellow"];function r(e){requestAnimationFrame((()=>{const t=e.drawable.current;if(t){const o=s.getKeyAtDomPos(t.pos,e.orientation,e.dom.bounds());o||(t.snapToValidMove=!1);const n=t.snapToValidMove?s.getSnappedKeyAtDomPos(t.orig,t.pos,e.orientation,e.dom.bounds()):o;n!==t.mouseSq&&(t.mouseSq=n,t.dest=n!==t.orig?n:void 0,e.dom.redrawNow()),r(e)}}))}function i(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function a(e){var t;const r=(e.shiftKey||e.ctrlKey)&&n.isRightButton(e),s=e.altKey||e.metaKey||(null===(t=e.getModifierState)||void 0===t?void 0:t.call(e,"AltGraph"));return o[(r?1:0)+(s?2:0)]}function c(e){e.onChange&&e.onChange(e.shapes)}t.start=function(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?s.unselect(e):s.cancelMove(e);const o=n.eventPosition(t),i=s.getKeyAtDomPos(o,e.orientation,e.dom.bounds());i&&(e.drawable.current={orig:i,pos:o,brush:a(t),snapToValidMove:e.drawable.defaultSnapToValidMove},r(e))},t.processDraw=r,t.move=function(e,t){e.drawable.current&&(e.drawable.current.pos=n.eventPosition(t))},t.end=function(e){const t=e.drawable.current;t&&(t.mouseSq&&function(e,t){const o=e=>e.orig===t.orig&&e.dest===t.dest,n=e.shapes.find(o);n&&(e.shapes=e.shapes.filter((e=>!o(e))));n&&n.brush===t.brush||e.shapes.push(t);c(e)}(e.drawable,t),i(e))},t.cancel=i,t.clear=function(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),c(e.drawable))}})),d=e((function(e,t){function o(e){requestAnimationFrame((()=>{var t;const s=e.draggable.current;if(!s)return;(null===(t=e.animation.current)||void 0===t?void 0:t.plan.anims.has(s.orig))&&(e.animation.current=void 0);const i=e.pieces.get(s.orig);if(i&&n.samePiece(i,s.piece)){if(!s.started&&n.distanceSq(s.pos,s.origPos)>=Math.pow(e.draggable.distance,2)&&(s.started=!0),s.started){if("function"==typeof s.element){const e=s.element();if(!e)return;e.cgDragging=!0,e.classList.add("dragging"),s.element=e}const t=e.dom.bounds();n.translateAbs(s.element,[s.pos[0]-t.left-t.width/16,s.pos[1]-t.top-t.height/16])}}else r(e);o(e)}))}function r(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,s.unselect(e),i(e),e.dom.redraw())}function i(e){const t=e.dom.elements;t.ghost&&n.setVisible(t.ghost,!1)}function a(e,t){let o=e.dom.elements.board.firstChild;for(;o;){if(o.cgKey===t&&"PIECE"===o.tagName)return o;o=o.nextSibling}}Object.defineProperty(t,"__esModule",{value:!0}),t.cancel=t.end=t.move=t.dragNewPiece=t.start=void 0,t.start=function(e,t){if(!t.isTrusted||void 0!==t.button&&0!==t.button)return;if(t.touches&&t.touches.length>1)return;const r=e.dom.bounds(),i=n.eventPosition(t),d=s.getKeyAtDomPos(i,e.orientation,r);if(!d)return;const u=e.pieces.get(d),p=e.selected;p||!e.drawable.enabled||!e.drawable.eraseOnClick&&u&&u.color===e.turnColor||l.clear(e),!1===t.cancelable||t.touches&&e.movable.color&&!u&&!p&&!function(e,t){const o=e.orientation,r=e.dom.bounds(),s=Math.pow(r.width/8,2);for(const i in e.pieces){const e=n.computeSquareCenter(i,o,r);if(n.distanceSq(e,t)<=s)return!0}return!1}(e,i)||t.preventDefault();const f=!!e.premovable.current,g=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&s.canMove(e,e.selected,d)?c.anim((e=>s.selectSquare(e,d)),e):s.selectSquare(e,d);const v=e.selected===d,h=a(e,d);if(u&&h&&v&&s.isDraggable(e,d)){e.draggable.current={orig:d,piece:u,origPos:i,pos:i,started:e.draggable.autoDistance&&e.stats.dragged,element:h,previouslySelected:p,originTarget:t.target},h.cgDragging=!0,h.classList.add("dragging");const s=e.dom.elements.ghost;s&&(s.className=`ghost ${u.color} ${u.role}`,n.translateAbs(s,n.posToTranslateAbs(r)(n.key2pos(d),e.orientation)),n.setVisible(s,!0)),o(e)}else f&&s.unsetPremove(e),g&&s.unsetPredrop(e);e.dom.redraw()},t.dragNewPiece=function(e,t,r,s){const i="a0";e.pieces.set(i,t),e.dom.redraw();const c=n.eventPosition(r);e.draggable.current={orig:i,piece:t,origPos:c,pos:c,started:!0,element:()=>a(e,i),originTarget:r.target,newPiece:!0,force:!!s},o(e)},t.move=function(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=n.eventPosition(t))},t.end=function(e,t){const o=e.draggable.current;if(!o)return;if("touchend"===t.type&&!1!==t.cancelable&&t.preventDefault(),"touchend"===t.type&&o.originTarget!==t.target&&!o.newPiece)return void(e.draggable.current=void 0);s.unsetPremove(e),s.unsetPredrop(e);const r=n.eventPosition(t)||o.pos,a=s.getKeyAtDomPos(r,e.orientation,e.dom.bounds());a&&o.started&&o.orig!==a?o.newPiece?s.dropNewPiece(e,o.orig,a,o.force):(e.stats.ctrlKey=t.ctrlKey,s.userMove(e,o.orig,a)&&(e.stats.dragged=!0)):o.newPiece?e.pieces.delete(o.orig):e.draggable.deleteOnDropOff&&!a&&(e.pieces.delete(o.orig),s.callUserFunction(e.events.change)),(o.orig!==o.previouslySelected||o.orig!==a&&a)&&e.selectable.enabled||s.unselect(e),i(e),e.draggable.current=void 0,e.dom.redraw()},t.cancel=r})),u=e((function(e,t){function o(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}Object.defineProperty(t,"__esModule",{value:!0}),t.explosion=void 0,t.explosion=function(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout((()=>{o(e,2),setTimeout((()=>o(e,void 0)),120)}),120)}})),p=e((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.start=void 0,t.start=function(e,t){return{set(o){var n;o.orientation&&o.orientation!==e.orientation&&(n=o.orientation,s.setOrientation(e,n),t()),(o.fen?c.anim:c.render)((e=>a.configure(e,o)),e)},state:e,getFen:()=>i.write(e.pieces),toggleOrientation:function(){s.toggleOrientation(e),t()},setPieces(t){c.anim((e=>s.setPieces(e,t)),e)},selectSquare(t,o){t?c.anim((e=>s.selectSquare(e,t,o)),e):e.selected&&(s.unselect(e),e.dom.redraw())},move(t,o){c.anim((e=>s.baseMove(e,t,o)),e)},newPiece(t,o){c.anim((e=>s.baseNewPiece(e,t,o)),e)},playPremove(){if(e.premovable.current){if(c.anim(s.playPremove,e))return!0;e.dom.redraw()}return!1},playPredrop(t){if(e.predroppable.current){const o=s.playPredrop(e,t);return e.dom.redraw(),o}return!1},cancelPremove(){c.render(s.unsetPremove,e)},cancelPredrop(){c.render(s.unsetPredrop,e)},cancelMove(){c.render((e=>{s.cancelMove(e),d.cancel(e)}),e)},stop(){c.render((e=>{s.stop(e),d.cancel(e)}),e)},explode(t){u.explosion(e,t)},setAutoShapes(t){c.render((e=>e.drawable.autoShapes=t),e)},setShapes(t){c.render((e=>e.drawable.shapes=t),e)},getKeyAtDomPos:t=>s.getKeyAtDomPos(t,e.orientation,e.dom.bounds()),redrawAll:t,dragNewPiece(t,o,n){d.dragNewPiece(e,t,o,n)},destroy(){s.stop(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}})),f=e((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.defaults=void 0,t.defaults=function(){return{pieces:i.read(i.initial),orientation:"white",turnColor:"white",coordinates:!0,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,resizable:!0,addPieceZIndex:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://lichess1.org/assets/piece/cburnett/"},prevSvgHash:""},hold:n.timer()}}})),g=e((function(e,t){function r(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function s(e,t,o,n,r){const s=e.dom.bounds(),i=new Map,a=[];for(const l of t)i.set(l.hash,!1);let c,d=r.firstChild;for(;d;)c=d.getAttribute("cgHash"),i.has(c)?i.set(c,!0):a.push(d),d=d.nextSibling;for(const l of a)r.removeChild(l);for(const u of t)i.get(u.hash)||r.appendChild(l(e,u,o,n,s))}function i({orig:e,dest:t,brush:o,piece:n,modifiers:r,customSvg:s},i,l,d){return[d.width,d.height,l,e,t,o,t&&(i.get(t)||0)>1,n&&a(n),r&&(u=r,""+(u.lineWidth||"")),s&&c(s)].filter((e=>e)).join(",");var u}function a(e){return[e.color,e.role,e.scale].filter((e=>e)).join(",")}function c(e){let t=0;for(let o=0;o<e.length;o++)t=(t<<5)-t+e.charCodeAt(o)>>>0;return"custom-"+t.toString()}function l(e,{shape:t,current:o,hash:s},i,a,c){let l;if(t.customSvg){const o=p(n.key2pos(t.orig),e.orientation);l=function(e,t,o){const{width:n,height:s}=o,i=n/8,a=s/8,c=t[0]*i,l=(7-t[1])*a,d=u(r("g"),{transform:`translate(${c},${l})`}),p=u(r("svg"),{width:i,height:a,viewBox:"0 0 100 100"});return d.appendChild(p),p.innerHTML=e,d}(t.customSvg,o,c)}else if(t.piece)l=function(e,t,o,n){const s=h(t,n),i=n.width/8*(o.scale||1),a=o.color[0]+("knight"===o.role?"n":o.role[0]).toUpperCase();return u(r("image"),{className:`${o.role} ${o.color}`,x:s[0]-i/2,y:s[1]-i/2,width:i,height:i,href:e+a+".svg"})}(e.drawable.pieces.baseUrl,p(n.key2pos(t.orig),e.orientation),t.piece,c);else{const s=p(n.key2pos(t.orig),e.orientation);if(t.dest){let d=i[t.brush];t.modifiers&&(d=f(d,t.modifiers)),l=function(e,t,o,n,s,i){const a=function(e,t){return(t?20:10)/512*e.width}(i,s&&!n),c=h(t,i),l=h(o,i),d=l[0]-c[0],p=l[1]-c[1],f=Math.atan2(p,d),m=Math.cos(f)*a,b=Math.sin(f)*a;return u(r("line"),{stroke:e.color,"stroke-width":g(e,n,i),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:v(e,n),x1:c[0],y1:c[1],x2:l[0]-m,y2:l[1]-b})}(d,s,p(n.key2pos(t.dest),e.orientation),o,(a.get(t.dest)||0)>1,c)}else l=function(e,t,o,n){const s=h(t,n),i=function(e){const t=e.width/512;return[3*t,4*t]}(n),a=(n.width+n.height)/32;return u(r("circle"),{stroke:e.color,"stroke-width":i[o?0:1],fill:"none",opacity:v(e,o),cx:s[0],cy:s[1],r:a-i[1]/2})}(i[t.brush],s,o,c)}return l.setAttribute("cgHash",s),l}function d(e){const t=u(r("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return t.appendChild(u(r("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function u(e,t){for(const o in t)e.setAttribute(o,t[o]);return e}function p(e,t){return o.mapToWhiteInverse[t](e)}function f(e,t){return{color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter((e=>e)).join("")}}function g(e,t,o){return(e.lineWidth||10)*(t?.85:1)/512*o.width}function v(e,t){return(e.opacity||1)*(t?.9:1)}function h(e,t){return[(e[0]+.5)*t.width/8,(7.5-e[1])*t.height/8]}Object.defineProperty(t,"__esModule",{value:!0}),t.setAttributes=t.renderSvg=t.createElement=void 0,t.createElement=r,t.renderSvg=function(e,t,o){const n=e.drawable,r=n.current,a=r&&r.mouseSq?r:void 0,c=new Map,l=e.dom.bounds();for(const s of n.shapes.concat(n.autoShapes).concat(a?[a]:[]))s.dest&&c.set(s.dest,(c.get(s.dest)||0)+1);const u=n.shapes.concat(n.autoShapes).map((e=>({shape:e,current:!1,hash:i(e,c,!1,l)})));a&&u.push({shape:a,current:!0,hash:i(a,c,!0,l)});const p=u.map((e=>e.hash)).join(";");if(p===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=p;const g=t.querySelector("defs"),v=t.querySelector("g"),h=o.querySelector("g");!function(e,t,o){const n=new Map;let r;for(const a of t)a.shape.dest&&(r=e.brushes[a.shape.brush],a.shape.modifiers&&(r=f(r,a.shape.modifiers)),n.set(r.key,r));const s=new Set;let i=o.firstChild;for(;i;)s.add(i.getAttribute("cgKey")),i=i.nextSibling;for(const[a,c]of n.entries())s.has(a)||o.appendChild(d(c))}(n,u,g),s(e,u.filter((e=>!e.shape.customSvg)),n.brushes,c,v),s(e,u.filter((e=>e.shape.customSvg)),n.brushes,c,h)},t.setAttributes=u})),v=e((function(e,o){function r(e,t){const o=n.createEl("coords",t);let r;for(const s of e)r=n.createEl("coord"),r.textContent=s,o.appendChild(r);return o}Object.defineProperty(o,"__esModule",{value:!0}),o.renderWrap=void 0,o.renderWrap=function(e,o,s){e.innerHTML="",e.classList.add("cg-wrap");for(const n of t.orientations)e.classList.toggle("orientation-"+n,o.orientation===n);e.classList.toggle("manipulable",!o.viewOnly);const i=n.createEl("cg-helper");e.appendChild(i);const a=n.createEl("cg-container");i.appendChild(a);const c=n.createEl("cg-board");let l,d,u;if(a.appendChild(c),o.drawable.visible&&!s&&(l=g.setAttributes(g.createElement("svg"),{class:"cg-shapes"}),l.appendChild(g.createElement("defs")),l.appendChild(g.createElement("g")),d=g.setAttributes(g.createElement("svg"),{class:"cg-custom-svgs"}),d.appendChild(g.createElement("g")),a.appendChild(l),a.appendChild(d)),o.coordinates){const e=" "+o.orientation;a.appendChild(r(t.ranks,"ranks"+e)),a.appendChild(r(t.files,"files"+e))}return o.draggable.showGhost&&!s&&(u=n.createEl("piece","ghost"),n.setVisible(u,!1),a.appendChild(u)),{board:c,container:a,ghost:u,svg:l,customSvg:d}}})),h=e((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.drop=t.cancelDropMode=t.setDropMode=void 0,t.setDropMode=function(e,t){e.dropmode={active:!0,piece:t},d.cancel(e)},t.cancelDropMode=function(e){e.dropmode={active:!1}},t.drop=function(e,t){if(!e.dropmode.active)return;s.unsetPremove(e),s.unsetPredrop(e);const o=e.dropmode.piece;if(o){e.pieces.set("a0",o);const r=n.eventPosition(t),i=r&&s.getKeyAtDomPos(r,e.orientation,e.dom.bounds());i&&s.dropNewPiece(e,"a0",i)}e.dom.redraw()}})),m=e((function(e,t){function o(e,t,o,n){return e.addEventListener(t,o,n),()=>e.removeEventListener(t,o,n)}function r(e,t,o){return n=>{e.drawable.current?e.drawable.enabled&&o(e,n):e.viewOnly||t(e,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.bindDocument=t.bindBoard=void 0,t.bindBoard=function(e,t){const o=e.dom.elements.board;if(!e.dom.relative&&e.resizable&&"ResizeObserver"in window){new window.ResizeObserver(t).observe(o)}if(e.viewOnly)return;const r=function(e){return t=>{e.draggable.current?d.cancel(e):e.drawable.current?l.cancel(e):t.shiftKey||n.isRightButton(t)?e.drawable.enabled&&l.start(e,t):e.viewOnly||(e.dropmode.active?h.drop(e,t):d.start(e,t))}}(e);o.addEventListener("touchstart",r,{passive:!1}),o.addEventListener("mousedown",r,{passive:!1}),(e.disableContextMenu||e.drawable.enabled)&&o.addEventListener("contextmenu",(e=>e.preventDefault()))},t.bindDocument=function(e,t){const n=[];if(e.dom.relative||!e.resizable||"ResizeObserver"in window||n.push(o(document.body,"chessground.resize",t)),!e.viewOnly){const t=r(e,d.move,l.move),s=r(e,d.end,l.end);for(const e of["touchmove","mousemove"])n.push(o(document,e,t));for(const e of["touchend","mouseup"])n.push(o(document,e,s));const i=()=>e.dom.bounds.clear();n.push(o(document,"scroll",i,{capture:!0,passive:!0})),n.push(o(window,"resize",i,{passive:!0}))}return()=>n.forEach((e=>e()))}})),b=e((function(e,t){function r(e){return"PIECE"===e.tagName}function s(e){return"SQUARE"===e.tagName}function i(e,t){for(const o of t)e.dom.elements.board.removeChild(o)}function a(e,t){return 2+8*(e=o.mapToWhite[t](e))[1]+(7-e[0])+""}function c(e){return`${e.color} ${e.role}`}function l(e,t,o){const n=e.get(t);n?e.set(t,`${n} ${o}`):e.set(t,o)}function d(e,t,o){const n=e.get(t);n?n.push(o):e.set(t,[o])}Object.defineProperty(t,"__esModule",{value:!0}),t.updateBounds=t.render=void 0,t.render=function(e){const t=e.orientation,o=e.dom.relative?n.posToTranslateRel:n.posToTranslateAbs(e.dom.bounds()),u=e.dom.relative?n.translateRel:n.translateAbs,p=e.dom.elements.board,f=e.pieces,g=e.animation.current,v=g?g.plan.anims:new Map,h=g?g.plan.fadings:new Map,m=e.draggable.current,b=function(e){var t;const o=new Map;if(e.lastMove&&e.highlight.lastMove)for(const s of e.lastMove)l(o,s,"last-move");e.check&&e.highlight.check&&l(o,e.check,"check");if(e.selected&&(l(o,e.selected,"selected"),e.movable.showDests)){const n=null===(t=e.movable.dests)||void 0===t?void 0:t.get(e.selected);if(n)for(const t of n)l(o,t,"move-dest"+(e.pieces.has(t)?" oc":""));const r=e.premovable.dests;if(r)for(const t of r)l(o,t,"premove-dest"+(e.pieces.has(t)?" oc":""))}const n=e.premovable.current;if(n)for(const s of n)l(o,s,"current-premove");else e.predroppable.current&&l(o,e.predroppable.current.key,"current-premove");const r=e.exploding;if(r)for(const s of r.keys)l(o,s,"exploding"+r.stage);return o}(e),w=new Set,y=new Set,k=new Map,P=new Map;let M,C,S,A,O,K,T,q,D,_;for(C=p.firstChild;C;){if(M=C.cgKey,r(C))if(S=f.get(M),O=v.get(M),K=h.get(M),A=C.cgPiece,!C.cgDragging||m&&m.orig===M||(C.classList.remove("dragging"),u(C,o(n.key2pos(M),t)),C.cgDragging=!1),!K&&C.cgFading&&(C.cgFading=!1,C.classList.remove("fading")),S){if(O&&C.cgAnimating&&A===c(S)){const e=n.key2pos(M);e[0]+=O[2],e[1]+=O[3],C.classList.add("anim"),u(C,o(e,t))}else C.cgAnimating&&(C.cgAnimating=!1,C.classList.remove("anim"),u(C,o(n.key2pos(M),t)),e.addPieceZIndex&&(C.style.zIndex=a(n.key2pos(M),t)));A!==c(S)||K&&C.cgFading?K&&A===c(K)?(C.classList.add("fading"),C.cgFading=!0):d(k,A,C):w.add(M)}else d(k,A,C);else if(s(C)){const e=C.className;b.get(M)===e?y.add(M):d(P,e,C)}C=C.nextSibling}for(const[r,s]of b)if(!y.has(r)){D=P.get(s),_=D&&D.pop();const e=o(n.key2pos(r),t);if(_)_.cgKey=r,u(_,e);else{const t=n.createEl("square",s);t.cgKey=r,u(t,e),p.insertBefore(t,p.firstChild)}}for(const[r,s]of f)if(O=v.get(r),!w.has(r))if(T=k.get(c(s)),q=T&&T.pop(),q){q.cgKey=r,q.cgFading&&(q.classList.remove("fading"),q.cgFading=!1);const s=n.key2pos(r);e.addPieceZIndex&&(q.style.zIndex=a(s,t)),O&&(q.cgAnimating=!0,q.classList.add("anim"),s[0]+=O[2],s[1]+=O[3]),u(q,o(s,t))}else{const i=c(s),l=n.createEl("piece",i),d=n.key2pos(r);l.cgPiece=i,l.cgKey=r,O&&(l.cgAnimating=!0,d[0]+=O[2],d[1]+=O[3]),u(l,o(d,t)),e.addPieceZIndex&&(l.style.zIndex=a(d,t)),p.appendChild(l)}for(const n of k.values())i(e,n);for(const n of P.values())i(e,n)},t.updateBounds=function(e){if(e.dom.relative)return;const t=e.orientation,o=n.posToTranslateAbs(e.dom.bounds());let i=e.dom.elements.board.firstChild;for(;i;)(r(i)&&!i.cgAnimating||s(i))&&n.translateAbs(i,o(n.key2pos(i.cgKey),t)),i=i.nextSibling}}));return e((function(e,t){function o(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame((()=>{e(),t=!1})))}}Object.defineProperty(t,"__esModule",{value:!0}),t.Chessground=void 0,t.Chessground=function(e,t){const r=f.defaults();function s(){const t="dom"in r?r.dom.unbind:void 0,s=r.viewOnly&&!r.drawable.visible,i=v.renderWrap(e,r,s),a=n.memo((()=>i.board.getBoundingClientRect())),c=e=>{b.render(d),!e&&i.svg&&g.renderSvg(d,i.svg,i.customSvg)},l=()=>{a.clear(),b.updateBounds(d),i.svg&&g.renderSvg(d,i.svg,i.customSvg)},d=r;return d.dom={elements:i,bounds:a,redraw:o(c),redrawNow:c,unbind:t,relative:s},d.drawable.prevSvgHash="",c(!1),m.bindBoard(d,l),t||(d.dom.unbind=m.bindDocument(d,l)),d.events.insert&&d.events.insert(i),d}return a.configure(r,t||{}),p.start(s(),s)}})).Chessground}();
